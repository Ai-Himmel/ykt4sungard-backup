-- 更新 SYSKEY 表   
ALTER TABLE YKT_CUR.T_PIF_SYSKEY
  ADD KEY_TYPE  CHARACTER(1)    NOT NULL  DEFAULT '0';

#SYNC 10;

COMMENT ON YKT_CUR.T_PIF_SYSKEY
 (KEY_TYPE IS '标志'
 );

#SYNC 20;

REBIND PACKAGE BANK.SYSKEY;

#SYNC 30;

REBIND PACKAGE DB2INST4.SYSKEY;

#SYNC 40;

-- 增加一个 SYSKEY
insert into YKT_CUR.T_PIF_SYSKEY(KEY_CODE,KEY_NAME,KEY_VALUE,MAX_VALUE,KEY_TYPE)
values('T_TIF_CUT_INFO_UPDATE','客户信息更新记录表',0,99999999,'1');

-- 增加 T_TIF_CUT_INFO_UPDATE 表

CREATE TABLE YKT_CUR.T_TIF_CUT_INFO_UPDATE
 (ID            INTEGER         NOT NULL  GENERATED ALWAYS
    AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER),
  CARD_ID       INTEGER         NOT NULL,
  VOLUME        VARCHAR(12)     NOT NULL,
  FLAG          INTEGER         NOT NULL  DEFAULT 0,
  OPERATE_DATE  CHARACTER(8),
  OPERATE_TIME  CHARACTER(6)
 )
  DATA CAPTURE NONE
  IN USERSPACE1;

ALTER TABLE YKT_CUR.T_TIF_CUT_INFO_UPDATE
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;

COMMENT ON YKT_CUR.T_TIF_CUT_INFO_UPDATE
 (ID IS 'ID主键',
  CARD_ID IS '交易卡号',
  VOLUME IS '版本号',
  FLAG IS '标志',
  OPERATE_DATE IS '记录日期',
  OPERATE_TIME IS '记录时间'
 );

ALTER TABLE YKT_CUR.T_TIF_CUT_INFO_UPDATE
  ADD CONSTRAINT SQL050830162420000 PRIMARY KEY
   (ID
   );

ALTER TABLE YKT_CUR.T_TIF_CUT_INFO_UPDATE
  ADD CONSTRAINT SQL050830162420170 UNIQUE
   (VOLUME
   );

-- 增加客户信息更新记录表视图

CREATE VIEW YKT_CUR.V_CUT_CARD_INFO
 (CARD_ID,
  PHYSICAL_NO,
  STUEMP_NO,
  CLASSDEPT_NO,
  S_CODE,
  SEX,
  CUT_TYPE,
  FEE_TYPE,
  END_TIME,
  CUT_STATE,
  VOLUME,
  FLAG
 )
  AS select cd.card_id,cd.physical_no,cut.stuemp_no,cut.classdept_no ,cut.s_code, 
    cut.sex,cut.cut_type,cut.fee_type,cd.end_time,cut.cut_state,ci.volume,
    ci.flag
  from YKT_CUR.T_PIF_CARD as cd,YKT_CUR.T_CIF_CUSTOMER as cut , 
    ykt_cur.t_tif_cut_info_update as ci
  where cd.cosumer_id=cut.cut_id
    and cd.card_id=ci.card_id;