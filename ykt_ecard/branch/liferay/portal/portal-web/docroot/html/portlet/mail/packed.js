RecipientSelector=new Class({initialize:function(inputId){var instance=this;var textInput=jQuery("#"+inputId);textInput.Autocomplete({source:function(data){var xHR=jQuery.ajax({url:themeDisplay.getPathMain()+"/mail/action",data:{cmd:"getRecipients",data:data.value},dataType:"json",async:false});return eval(xHR.responseText)},delay:0,fx:{type:"slide",duration:400},autofill:true,dataSourceType:"json",helperClass:"autocomplete-box",selectClass:"autocomplete-selected",minchars:1,multiple:true,multipleSeparator:",",onSelect:function(){},onShow:function(){},onHide:function(){}})}});function MailSummaryObject(A,F,H,E,I,B,C,D,G){this.next=null;this.prev=null;this.selected=false;this.state=A;this.id=B;this.index=G;this.folderId=D;this.selectedIndex=-1;this.read=C;this.head=F;this.pendingHighlight=false;this.row=new Array();this.row[0]=A;this.row[1]=F;this.row[2]=H;this.row[3]=E;this.row[4]=I;F.parent=this;H.parent=this;E.parent=this;I.parent=this;F.onmousedown=H.onmousedown=E.onmousedown=I.onmousedown=Mail.onSummaryMouseDown;F.ondblclick=H.ondblclick=E.ondblclick=I.ondblclick=Mail.onSummaryDblclick}var Mail={INBOX_NAME:null,DRAFTS_NAME:null,SENT_NAME:null,SPAM_NAME:null,TRASH_NAME:null,DEFAULT_FOLDERS:null,currentFolder:null,currentFolderId:"",currentMessageId:null,displayingMessage:false,dragging:false,dragIndicator:null,dragStart:null,foldersList:null,groupStart:null,lastSelected:null,mailObject:null,messageTimer:null,previewLast:-1,previewHeight:0,searchResults:false,searchCount:0,selectedArray:null,selectedClassName:"portlet-section-selected",scrollTimer:null,sortBy:null,summaryList:{head:null,tail:null},buildChain:function(A,B){if(A==null){return new Array(B)}else{A[A.length]=B;return A}},checkFolderLocation:function(H,G){var E=document.getElementById("portlet-mail-folder-pane");var C=E.getElementsByTagName("li");var F=false;for(var D=0;D<C.length;D++){var B=C[D];if(B.id=="folder_management"){continue}if(G==true){B.nwOffset=Coordinates.northwestOffset(B,true);B.seOffset=Coordinates.southeastOffset(B,true)}if(Mail.isMoveAllowed(B.folder.id)){if(H.inside(B.nwOffset,B.seOffset)){jQuery(B).addClass(Mail.selectedClassName);F=true}else{jQuery(B).removeClass(Mail.selectedClassName)}}}if(Mail.dragIndicator!=null){var A=Mail.dragIndicator.getElementsByTagName("span")[0];if(F){A.innerHTML="&laquo;";A.style.color="#55FF55"}else{A.innerHTML="X";A.style.color="#FF5555"}}},clearPreview:function(){if(!Mail.summaryList){return }var E=document.getElementById("portlet-mail-msgs-state");var B=document.getElementById("portlet-mail-msgs-from");var A=document.getElementById("portlet-mail-msgs-subject");var C=document.getElementById("portlet-mail-msgs-received");var D=document.getElementById("portlet-mail-msgs-size");Mail.summaryList.head=null;Mail.summaryList.tail=null;E.innerHTML="";B.innerHTML="";A.innerHTML="";C.innerHTML="";D.innerHTML=""},decrementCount:function(A){var C=Mail.currentFolder.li.getElementsByTagName("span");if(C.length>0){C[0].parentNode.removeChild(C[0]);if(A){Mail.currentFolder.li.newCount++;Mail.currentFolder.newCount++}else{Mail.currentFolder.li.newCount--;Mail.currentFolder.newCount--}var D=Mail.currentFolder.li.newCount;if(D>0){var B=document.createElement("span");B.innerHTML="&nbsp;("+D+")";B.className="font-small";Mail.currentFolder.li.appendChild(B)}}},deleteSelectedMessages:function(A){clearTimeout(Mail.messageTimer);var D;if(Mail.searchResults){D="search results"}else{D=Mail.currentFolder.name}var C=Mail.getSelectedMessages();var B="Delete "+C.length+" message"+(C.length>1?"s":"")+" from "+D+"?";if(C.length>0&&(A||confirm(B))){loadPage(themeDisplay.getPathMain()+"/mail/action","cmd=deleteMessages&messages="+C);Mail.getFolders();Mail.removeSelectedMessages();Mail.searchCount-=C.length}},dragToFolder:function(F){var E=document.getElementById("portlet-mail-folder-pane");var C=E.getElementsByTagName("li");for(var D=0;D<C.length;D++){var B=C[D];if(B.id=="folder_management"){continue}var A=F.inside(Coordinates.northwestOffset(B,true),Coordinates.southeastOffset(B,true));if(A){Mail.moveToFolder(B.folder.id)}}},resetLastSelected:function(){Mail.lastSelected=null;Mail.groupStart=null},removeSelectedMessages:function(){var B=document.getElementById("portlet-mail-msg-detailed-frame");var A;if(Mail.lastSelected==null){Mail.lastSelected=Mail.findLastSelected()}A=Mail.lastSelected.next;B.src="";while(A&&A.selected){A=A.next}Mail.getSelectedMessages(Mail.removeSummary);Mail.selectedArray=null;Mail.resetLastSelected();if(A!=null){Mail.summaryHighlight(A);Mail.groupStart=A}else{Mail.getFolderDetails()}},removeSummary:function(D){var G=D.next;var B=D.prev;var F=D.row;var A=Mail.selectedArray;if(A!=null){A[D.selectedIndex]=null}for(var C=0;C<F.length;C++){var E=F[C];E.parentNode.removeChild(E);E.onmousedown=null;E.next=null;E=null}if(G!=null){G.prev=B}if(B!=null){B.next=G}if(Mail.summaryList.tail==D){Mail.summaryList.tail=B}if(Mail.summaryList.head==D){Mail.summaryList.head=G}D=null},submitCompose:function(B,A){var C=Mail.getSelectedMessages();if(C.length==1){document.getElementById("portlet-mail-compose-action").value=B;document.getElementById("portlet-mail-folder-id").value=C[0][0];document.getElementById("portlet-mail-message-id").value=C[0][1];submitForm(A)}else{alert("Please select a single message")}},getFolderDetails:function(){var E=document.getElementById("portlet-mail-msg-detailed-frame");var A=document.getElementById("portlet-mail-msg-header-div");var C=document.createElement("div");var B=document.createElement("div");var D=document.createElement("div");if(Mail.searchResults){C.innerHTML="Search Results";C.style.fontWeight="bold";C.className="font-xx-large";B.innerHTML=Mail.searchCount+"&nbsp;Total"}else{C.innerHTML=Mail.currentFolder.name;C.style.fontWeight="bold";C.className="font-xx-large";if(Mail.currentFolder.newCount>0){D.innerHTML=Mail.currentFolder.newCount+"&nbsp;Unread"}B.innerHTML=Mail.currentFolder.totalCount+"&nbsp;Total"}E.src="";A.innerHTML="";A.appendChild(C);A.appendChild(D);A.appendChild(B)},emptyFolderReturn:function(A){var B=Liferay.Util.toJSONObject(A.responseText);Mail.getFolders();if(B.folderId==Mail.currentFolderId){Mail.getFolderDetails();Mail.clearPreview()}},findLastSelected:function(){var A=null;if(Mail.selectedArray!=null){var B=Mail.selectedArray;for(var C=B.length-1;C>=0;C--){var D=B[C];if(D!=null&&D.selected){A=D;break}}}return A},getFolders:function(A){loadPage(themeDisplay.getPathMain()+"/mail/action","cmd=getFolders",Mail.getFoldersReturn,A)},getFoldersReturn:function(E,O){var G=Liferay.Util.toJSONObject(E.responseText);var H=document.getElementById("portlet-mail-folder-pane");var L=document.createElement("ul");var C=G.folders;var Q=null;Mail.foldersList=C;var F=H.getElementsByTagName("div");if(F!=null&&F.length==1){H.removeChild(F[0])}var K=H.getElementsByTagName("ul");if(K!=null&&K.length==1){H.removeChild(K[0])}if(!Mail.searchResults){Q=C[0]}for(var I=0;I<C.length;I++){var B=C[I];var A=document.createElement("li");var D=document.createElement("a");var N=document.createElement("span");if(B.newCount>0){N.innerHTML="&nbsp;("+B.newCount+")"}N.className="font-small";D.innerHTML=B.name;D.appendChild(N);D.href="javascript:void(0)";D.onclick=Mail.onFolderSelect;A.folder=B;A.newCount=B.newCount;A.appendChild(D);if(B.id==Mail.TRASH_NAME||B.id==Mail.SPAM_NAME){var P=document.createElement("a");P.href="javascript:void(0)";P.className="font-x-small";P.innerHTML="[Empty]";P.onclick=Mail.onEmptyClick;A.appendChild(document.createTextNode(" "));A.appendChild(P)}L.appendChild(A);if(B.id==Mail.currentFolderId){Q=B;jQuery(A).addClass(Mail.selectedClassName)}if(I==Mail.DEFAULT_FOLDERS.length-1){var M=document.createElement("li");M.id="folder_management";var J=document.createElement("a");J.href="javascript:void(0)";J.onclick=Mail.onFolderAdd;J.innerHTML="<img src=\""+themeDisplay.getPathThemeImages()+"/mail/add_folder.png\" />";M.appendChild(J);if(Mail.DEFAULT_FOLDERS.length!=C.length){J=document.createElement("a");J.href="javascript:void(0)";J.onclick=Mail.onFolderRename;J.innerHTML="<img src=\""+themeDisplay.getPathThemeImages()+"/mail/rename_folder.png\" />";M.appendChild(J);J=document.createElement("a");J.href="javascript:void(0)";J.onclick=Mail.onFolderDelete;J.innerHTML="<img src=\""+themeDisplay.getPathThemeImages()+"/mail/delete_folder.png\" />";M.appendChild(J)}L.appendChild(M)}}H.appendChild(L);if(Mail.searchResults==true){Mail.getFolderDetails()}else{if(Mail.currentFolder==null||Mail.currentFolderId!=Q.id||O){Mail.setCurrentFolder(Q);Mail.getPreview()}}},getMessageDetails:function(B,A){if(!Mail.displayingMessage||B!=Mail.currentMessageId){loadPage(themeDisplay.getPathMain()+"/mail/action","cmd=getMessage&messageId="+B+"&folderId="+A,Mail.getMessageDetailsReturn,B)}},getMessageDetailsReturn:function(E,A){var C=Liferay.Util.toJSONObject(E.responseText);Mail.currentMessageId=C.id;Mail.displayingMessage=true;if(Mail.lastSelected!=null&&!Mail.lastSelected.read){Mail.decrementCount();var G=Mail.lastSelected.state.getElementsByTagName("img")[0];G.src=themeDisplay.getPathThemeImages()+"/mail/read.png";var H=Mail.lastSelected.row;for(var B=0;B<H.length;B++){var F=H[B];F.style.fontWeight="normal"}Mail.lastSelected.read=true}var D=document.getElementById("portlet-mail-msg-detailed-frame");D.src="";D.src=themeDisplay.getPathMain()+"/mail/view_message?noCache="+(new Date()).getTime();return },getPreview:function(){Mail.clearPreview();loadPage(themeDisplay.getPathMain()+"/mail/action","cmd=getPreview&folderId="+Mail.currentFolderId+"&sortBy="+Mail.sortBy.value+"&asc="+Mail.sortBy.asc,Mail.getPreviewReturn)},getPreviewReturn:function(B){var A=Liferay.Util.toJSONObject(B.responseText);Mail.searchResults=false;if(A.folderId==Mail.currentFolderId&&A.headers.length>0){Mail.previewLast=-1;Mail.mailObject=A;Mail.renderPreviewSection()}},getSearchReturn:function(B){var A=Liferay.Util.toJSONObject(B.responseText);Mail.currentMessageId=null;Mail.mailObject=A;Mail.searchResults=true;Mail.searchCount=A.headers.length;Mail.setCurrentFolder();Mail.clearPreview();Mail.renderPreviewSection();Mail.summaryUnhighlightAll();Mail.getFolderDetails()},getSelectedMessages:function(E){var D;var A=new Array();var F;var B=Mail.selectedArray;if(B!=null){for(var C=0;C<B.length;C++){D=B[C];if(D!=null&&D.selected){A.push(new Array(D.folderId,D.id));if(E){E(D)}}}}return(A)},init:function(J,E,K,M,L){Mail.INBOX_NAME=J;Mail.DRAFTS_NAME=E;Mail.SENT_NAME=K;Mail.SPAM_NAME=M;Mail.TRASH_NAME=L;Mail.DEFAULT_FOLDERS=new Array(J,E,K,M,L);jQuery("#portlet-mail-folder-pane").lResize({handle:"#portlet-mail-handle",direction:"horizontal",mode:"add",onComplete:Mail.updateFolderWidth});jQuery("#portlet-mail-msgs-preview").lResize({handle:"#portlet-mail-handle",direction:"horizontal",mode:"subtract"});jQuery("#portlet-mail-msg-detailed-pane").lResize({handle:"#portlet-mail-handle",direction:"horizontal",mode:"subtract"});jQuery("#portlet-mail-msg-header").lResize({handle:"#portlet-mail-handle",direction:"horizontal",mode:"subtract"});jQuery("#portlet-mail-msgs-preview-pane").lResize({handle:"#portlet-mail-msgs-handle",direction:"vertical",mode:"add",onComplete:Mail.updatePreviewHeight});jQuery("#portlet-mail-msg-detailed-frame").lResize({handle:"#portlet-mail-msgs-handle",direction:"vertical",mode:"subtract"});jQuery("#portlet-mail-msgs-title-from").lResize({handle:"#portlet-mail-msgs-from-handle",direction:"horizontal",mode:"add",onComplete:Mail.updateFromWidth});jQuery("#portlet-mail-msgs-from").lResize({handle:"#portlet-mail-msgs-from-handle",direction:"horizontal",mode:"add"});jQuery("#portlet-mail-msgs-title-subject").lResize({handle:"#portlet-mail-msgs-from-handle",direction:"horizontal",mode:"subtract"});jQuery("#portlet-mail-msgs-subject").lResize({handle:"#portlet-mail-msgs-from-handle",direction:"horizontal",mode:"subtract"});jQuery("#portlet-mail-msgs-title-subject").lResize({handle:"#portlet-mail-msgs-subject-handle",direction:"horizontal",mode:"add",onComplete:Mail.updateSubjectWidth});jQuery("#portlet-mail-msgs-subject").lResize({handle:"#portlet-mail-msgs-subject-handle",direction:"horizontal",mode:"add"});jQuery("#portlet-mail-msgs-title-received").lResize({handle:"#portlet-mail-msgs-subject-handle",direction:"horizontal",mode:"subtract"});jQuery("#portlet-mail-msgs-received").lResize({handle:"#portlet-mail-msgs-subject-handle",direction:"horizontal",mode:"subtract"});jQuery("#portlet-mail-msgs-title-received").lResize({handle:"#portlet-mail-msgs-received-handle",direction:"horizontal",mode:"add",onComplete:Mail.updateReceivedWidth});jQuery("#portlet-mail-msgs-received").lResize({handle:"#portlet-mail-msgs-received-handle",direction:"horizontal",mode:"add"});jQuery("#portlet-mail-msgs-title-size").lResize({handle:"#portlet-mail-msgs-received-handle",direction:"horizontal",mode:"subtract"});jQuery("#portlet-mail-msgs-size").lResize({handle:"#portlet-mail-msgs-received-handle",direction:"horizontal",mode:"subtract"});jQuery("#portlet-mail-msg-detailed-frame").lResize({handle:"#portlet-mail-bottom-handle",direction:"vertical",mode:"add",onComplete:Mail.updateDetailedHeight});var B=document.getElementById("portlet-mail-msgs-title-state");var F=document.getElementById("portlet-mail-msgs-title-from");var I=document.getElementById("portlet-mail-msgs-from-handle");var A=document.getElementById("portlet-mail-msgs-title-subject");var N=document.getElementById("portlet-mail-msgs-subject-handle");var C=document.getElementById("portlet-mail-msgs-title-received");var H=document.getElementById("portlet-mail-msgs-received-handle");var G=document.getElementById("portlet-mail-msgs-title-size");B.asc=true;B.value="state";F.asc=true;F.value="name";A.asc=true;A.value="subject";C.asc=false;C.value="date";G.asc=false;G.value="size";B.onclick=F.onclick=A.onclick=C.onclick=G.onclick=Mail.onSortClick;Mail.sortBy=C;Mail.updateSortArrow();jQuery(document).keydown(Mail.onMailKeyPress);var D=jQuery("#portlet-mail-msgs-preview-pane");D[0].onselectstart=function(){return false};D.mousedown(function(){this.focus();return false});D.scroll(Mail.onPreviewScroll);jQuery(window).unload(Mail.clearPreview);Mail.getFolders()},isMoveAllowed:function(A){if(Mail.currentFolderId==A||A==Mail.DRAFTS_NAME||(Mail.currentFolderId==Mail.DRAFTS_NAME&&A!=Mail.TRASH_NAME)){return false}else{return true}},moveToFolder:function(A){var B=Mail.getSelectedMessages();if(B.length<=0){alert("Please select messages to move")}else{if(!Mail.isMoveAllowed(A)){alert("You cannot move to "+A)}else{confirmMsg="Move "+B.length+" message"+(B.length>1?"s":"")+" to "+A+"?";if(confirm(confirmMsg)){loadPage(themeDisplay.getPathMain()+"/mail/action","cmd=moveMessages&folderId="+A+"&messages="+B);Mail.removeSelectedMessages();Mail.searchCount-=B.length;Mail.getFolders()}}}},onEmptyClick:function(){folder=this.parentNode.folder;confirmMsg="Are you sure you want to empty the folder "+folder.id+"?";if(confirm(confirmMsg)){loadPage(themeDisplay.getPathMain()+"/mail/action","cmd=emptyFolder&folderId="+folder.id,Mail.emptyFolderReturn);Mail.getFolders()}},onFolderAdd:function(){var B=prompt("Please enter the name of a new folder.","");if(B!=null&&B!=""){for(var A=0;A<Mail.foldersList.length;A++){if(B.toLowerCase()==Mail.foldersList[A].name.toLowerCase()){alert("The folder '"+Mail.foldersList[A].name+"' already exists.");return }}loadPage(themeDisplay.getPathMain()+"/mail/action","cmd=addFolder&folderId="+B,Mail.getFolders)}},onFolderDelete:function(){for(var A=0;A<Mail.DEFAULT_FOLDERS.length;A++){if(Mail.DEFAULT_FOLDERS[A]==Mail.currentFolderId){alert("The folder '"+Mail.currentFolderId+"' cannot be deleted.");return }}if(confirm("Are you sure you want to delete the folder '"+Mail.currentFolderId+"' and all its messages?")){loadPage(themeDisplay.getPathMain()+"/mail/action","cmd=deleteFolder&folderId="+Mail.currentFolderId,Mail.getFolders);Mail.setCurrentFolder(Mail.foldersList[0])}},onFolderRename:function(){for(var A=0;A<Mail.DEFAULT_FOLDERS.length;A++){if(Mail.DEFAULT_FOLDERS[A]==Mail.currentFolderId){alert("The folder '"+Mail.currentFolderId+"' cannot be edited.");return }}var B=prompt("Please enter a new name for the folder '"+Mail.currentFolderId+"'.","");if(B!=null&&B!=""&&B!=Mail.currentFolderId){loadPage(themeDisplay.getPathMain()+"/mail/action","cmd=renameFolder&folderId="+Mail.currentFolderId+"&newFolderId="+B,Mail.getFolders)}},onFolderSelect:function(){var A=this.parentNode.folder;if(Mail.currentFolderId!=A.id){Mail.searchResults=false;Mail.displayingMessage=false;Mail.currentMessageId=null;Mail.setCurrentFolder(A);Mail.getPreview()}},onMailKeyPress:function(E){var B={SHIFT:16,ESC:27,UP:38,DOWN:40,DELETE:46,A:65,D:68};if(!E){E=window.event}var A=E.keyCode;if((A==B.UP||A==B.DOWN)&&Mail.summaryList.head!=null){var D=Mail.lastSelected;var C;var G;if(Mail.lastSelected==null){Mail.lastSelected=Mail.groupStart=Mail.summaryList.head;C=G=Mail.lastSelected}else{if(A==B.DOWN){C=D.next;G=D.prev}else{if(A==B.UP){C=D.prev;G=D.next}}}if(Mail.groupStart==null){Mail.groupStart=Mail.lastSelected}if(E.shiftKey){var F="";if(Mail.lastSelected.index<Mail.groupStart.index){if(A==B.DOWN){F="unhl"}else{F="hl"}}else{if(Mail.lastSelected.index>Mail.groupStart.index){if(A==B.UP){F="unhl"}else{F="hl"}}else{F="hl"}}if(F=="hl"&&C){Mail.summaryHighlight(C,true)}else{if(F=="unhl"){Mail.summaryUnhighlight(Mail.lastSelected);Mail.lastSelected=C}}}else{if(C){Mail.summaryUnhighlightAll();Mail.summaryHighlight(C,E.shiftKey);Mail.groupStart=Mail.lastSelected}}Mail.scrollToSelected();return false}else{if(A==B.DELETE){Mail.deleteSelectedMessages()}else{if(A==B.ESC){Mail.summaryUnhighlightAll();Mail.getFolderDetails()}else{if(E.ctrlKey||E.metaKey){if(A==B.A){Mail.summaryHighlightAll();return false}if(A==B.D){Mail.deleteSelectedMessages(true)}}}}}},onMessageSelect:function(){alert(this.id)},onMoveFolderChange:function(){if(this.selectedIndex!=0){Mail.moveToFolder(this.options[this.selectedIndex].innerHTML)}this.selectedIndex=0},onPreviewScroll:function(){if(this.scrollTimer){clearTimeout(this.scrollTimer)}this.scrollTimer=setTimeout("Mail.renderPreviewSection()",500)},onSortClick:function(){if(Mail.sortBy==this){this.asc=this.asc?false:true}Mail.sortBy=this;Mail.updateSortArrow();if(Mail.searchResults==true){loadPage(themeDisplay.getPathMain()+"/mail/action","cmd=getSearchCached&sortBy="+Mail.sortBy.value+"&asc="+Mail.sortBy.asc,Mail.getSearchReturn)}else{Mail.getPreview()}},onSummaryDblclick:function(){msObj=this.parent;if(Mail.currentMessageId==msObj.id){Mail.previewPopup()}},onSummaryMouseDown:function(B){B=mousePos.update(B);var C=this;var A=C.parent;A.pendingHighlight=true;Mail.lastSelected=A;document.onmousemove=Mail.onSummaryMouseMove;document.onmouseup=Mail.onSummaryMouseUp;Mail.dragStart=new Coordinate(mousePos.x,mousePos.y);Mail.checkFolderLocation(mousePos,true);return false},onSummaryMouseMove:function(C){mousePos.update(C);var B=Mail.getSelectedMessages().length;if((B>0&&mousePos.distance(Mail.dragStart)>20)||Mail.dragging){Mail.dragging=true;Mail.lastSelected.pendingHighlight=false;var A=Mail.dragIndicator;if(A==null){A=document.createElement("div");document.getElementsByTagName("body")[0].appendChild(A);A.id="portlet-mail-drag-indicator";A.onselectstart=function(){return false};A.onmousedown=function(){return false};Mail.dragIndicator=A}A.innerHTML="<span>&nbsp;</span>&nbsp;"+B+" message"+(B!=1?"s":"");A.style.display="block";A.style.top=(mousePos.y-15)+"px";A.style.left=(mousePos.x-5)+"px";Mail.checkFolderLocation(mousePos)}},onSummaryMouseUp:function(C){C=mousePos.update(C);var A=Mail.dragIndicator;if(A!=null){A.style.display="none"}if(Mail.lastSelected.pendingHighlight){if(C.ctrlKey||C.metaKey){if(Mail.lastSelected.selected){Mail.summaryUnhighlight(Mail.lastSelected);Mail.resetLastSelected()}else{Mail.summaryHighlight(Mail.lastSelected,true);Mail.groupStart=Mail.lastSelected}}else{if(C.shiftKey){if(Mail.groupStart==null){Mail.groupStart=Mail.findLastSelected()}Mail.summaryHighlight(Mail.lastSelected,true);if(Mail.groupStart==null){Mail.groupStart=Mail.lastSelected}else{var B;var E=true;var D=Mail.lastSelected;if(Mail.lastSelected.index>Mail.groupStart.index){E=false}B=E?Mail.lastSelected.next:Mail.lastSelected.prev;while(B!=Mail.groupStart){Mail.summaryHighlight(B,C.shiftKey);B=E?B.next:B.prev}Mail.lastSelected=D}}else{Mail.summaryUnhighlightAll();Mail.groupStart=Mail.lastSelected;Mail.summaryHighlight(Mail.lastSelected)}}}document.onmousemove=null;document.onmouseup=null;if(Mail.dragging){Mail.dragToFolder(mousePos);Mail.dragging=false}},print:function(){var A=Mail.previewPopup();if(A!=null&&A.print){A.print()}else{alert("Please select a message")}},previewPopup:function(){var A=null;if(Mail.currentMessageId){var B=themeDisplay.getPathMain()+"/mail/view_message?header=true&messageId="+Mail.currentMessageId;A=window.open(B,"Print","menubar=yes,width=640,height=480,toolbar=no,resizable=yes,scrollbars=yes")}return A},renderPreviewSection:function(){var L=Mail.mailObject;var I=L.headers.length;var Q=document.getElementById("portlet-mail-msgs-state");var U=document.getElementById("portlet-mail-msgs-from");var H=document.getElementById("portlet-mail-msgs-subject");var E=document.getElementById("portlet-mail-msgs-received");var S=document.getElementById("portlet-mail-msgs-size");var N=Mail.summaryList;var K=25;var T=Mail.previewLast+1;var D=25;if(Mail.previewHeight){var V=document.getElementById("portlet-mail-msgs-preview-pane");D=Math.ceil(V.scrollTop/Mail.previewHeight)+25;if(D>(I-1)){D=I-1}if(D<=Mail.previewLast){return }}for(var P=T;P<=D;P++){var O=L.headers[P];var F=document.createElement("div");var M=document.createElement("img");var B=document.createElement("div");var G=document.createElement("div");var R=document.createElement("div");var J=document.createElement("div");var C=new MailSummaryObject(F,B,G,R,J,O.id,O.read,O.folderId,P);M.src=themeDisplay.getPathThemeImages()+"/mail/read.png";B.innerHTML=O.email;R.innerHTML=O.date;J.innerHTML=O.size;G.innerHTML=O.subject;if(Mail.searchResults){G.innerHTML="<span class='portlet-mail-folder-text'>"+O.folderId+"</span>"+G.innerHTML}if(!O.read){M.src=themeDisplay.getPathThemeImages()+"/mail/unread.png";B.style.fontWeight="bold";G.style.fontWeight="bold";R.style.fontWeight="bold";J.style.fontWeight="bold"}else{if(O.replied){M.src=themeDisplay.getPathThemeImages()+"/mail/replied.png"}}if(N.head==null){N.head=C;N.tail=N.head}else{N.tail.next=C;C.prev=N.tail;N.tail=C}F.appendChild(M);Q.appendChild(F);U.appendChild(B);H.appendChild(G);E.appendChild(R);S.appendChild(J);if(Mail.currentMessageId==C.id){Mail.summaryHighlight(C);Mail.lastSelected=C;Mail.scrollToSelected()}}if(D<(I-1)){var A=N.head.head.offsetHeight;Mail.previewHeight=A;U.style.height=(I*A)+"px"}else{U.style.height="auto"}Mail.previewLast=D},scrollToSelected:function(){var C=Mail.lastSelected.row[1];if(C){var E=document.getElementById("portlet-mail-msgs-preview-pane");var F=document.getElementById("portlet-mail-msgs-preview-pane-title");var G=Coordinates.southeastOffset(F,true).y;var D=G+E.offsetHeight;var A=Coordinates.northwestOffset(C,true).y-E.scrollTop;var B=A+C.offsetHeight;if(A<G){E.scrollTop-=G-A}if(B>D){E.scrollTop+=(B-D)}}},setCurrentFolder:function(A){Mail.currentFolder=A;if(A!=null){Mail.currentFolderId=A.id;Mail.getFolderDetails()}else{Mail.currentFolderId=null}var C=document.getElementById("portlet-mail-folder-pane");var H=C.getElementsByTagName("li");for(var D=0;D<H.length;D++){var B=H[D];if(B.id=="folder_management"){continue}else{if(Mail.currentFolderId==B.folder.id){jQuery(B).addClass(Mail.selectedClassName);Mail.currentFolder.li=B}else{jQuery(B).removeClass(Mail.selectedClassName)}}}var G=document.getElementById("portlet-mail-msgs-title-from");var J=G.getElementsByTagName("span");var E=document.getElementById("portlet-mail-main-toolbar");var F=document.getElementById("portlet-mail-drafts-toolbar");var I=document.getElementById("portlet-mail-empty-folder");if(A==null){J[0].style.display="none";J[1].style.display="none";J[2].style.display=""}else{if(Mail.currentFolderId==Mail.SENT_NAME||Mail.currentFolderId==Mail.DRAFTS_NAME){J[0].style.display="none";J[1].style.display="";J[2].style.display="none"}else{J[0].style.display="";J[1].style.display="none";J[2].style.display="none"}}if(Mail.currentFolderId==Mail.DRAFTS_NAME){E.style.display="none";F.style.display="block"}else{E.style.display="block";F.style.display="none"}},summaryHighlight:function(B,D,C){B.pendingHighlight=false;if(Mail.messageTimer){clearTimeout(Mail.messageTimer)}if(C==true){B.selected=false;if(B.selectedIndex>=0){Mail.selectedArray[B.selectedIndex]=null;B.selectedIndex=-1}}else{B.selected=true;Mail.lastSelected=B;if(Mail.selectedArray==null){Mail.selectedArray=new Array()}B.selectedIndex=(Mail.selectedArray.push(B))-1;if(!D){Mail.messageTimer=setTimeout("Mail.getMessageDetails("+B.id+",'"+B.folderId+"')",500)}}var E=B.row;for(var A=0;A<E.length;A++){if(C){jQuery(E[A]).removeClass(Mail.selectedClassName)}else{jQuery(E[A]).addClass(Mail.selectedClassName)}}},summaryHighlightAll:function(){var A=Mail.summaryList.head;while(A){Mail.summaryHighlight(A,true)}},summaryUnhighlight:function(A){Mail.summaryHighlight(A,null,true)},summaryUnhighlightAll:function(){var C=Mail.summaryList.head;var A=Mail.selectedArray;if(A!=null){for(var B=0;B<A.length;B++){if(A[B]!=null){Mail.summaryUnhighlight(A[B])}}}Mail.selectedArray=null},updateDetailedHeight:function(C,B){var A=document.getElementById("portlet-mail-msg-detailed-frame");C=Mail.buildChain(C,"detailed-frame-height");B=Mail.buildChain(B,A.style.height);Mail.updatePreferences(C,B)},updateFolderWidth:function(){var A=document.getElementById("portlet-mail-folder-pane");Mail.updatePreferences("folder-pane-width",A.style.width)},updateFromWidth:function(){var A=document.getElementById("portlet-mail-msgs-title-from");Mail.updateSubjectWidth(new Array("from-title-width"),new Array(A.style.width))},updateSubjectWidth:function(C,B){var A=document.getElementById("portlet-mail-msgs-title-subject");C=Mail.buildChain(C,"subject-title-width");B=Mail.buildChain(B,A.style.width);Mail.updateReceivedWidth(C,B)},updateReceivedWidth:function(C,A){var B=document.getElementById("portlet-mail-msgs-title-received");C=Mail.buildChain(C,"received-title-width");A=Mail.buildChain(A,B.style.width);Mail.updatePreferences(C,A)},updatePreferences:function(A,B){loadPage(themeDisplay.getPathMain()+"/mail/action","cmd=updatePreferences&key="+A+"&value="+B)},updatePreviewHeight:function(){var A=document.getElementById("portlet-mail-msgs-preview-pane");Mail.updateDetailedHeight(new Array("preview-pane-height"),new Array(A.style.height))},updateSortArrow:function(){var A=new Array();A[0]=document.getElementById("portlet-mail-msgs-title-from");A[1]=document.getElementById("portlet-mail-msgs-title-subject");A[2]=document.getElementById("portlet-mail-msgs-title-received");A[3]=document.getElementById("portlet-mail-msgs-title-size");for(var B=0;B<A.length;B++){var E=A[B];var C=E.getElementsByTagName("div")[0];var F=C.getElementsByTagName("img");var D;if(F.length>0){D=F[0];C.removeChild(D)}if(Mail.sortBy==E&&E!="state"){D=document.createElement("img");if(E.asc){D.src=themeDisplay.getPathThemeImages()+"/arrows/01_up.png"}else{D.src=themeDisplay.getPathThemeImages()+"/arrows/01_down.png"}C.appendChild(D)}}}}