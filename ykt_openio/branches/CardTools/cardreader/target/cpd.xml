<?xml version="1.0" encoding="UTF-8"?>
<pmd-cpd>
<duplication lines="74" tokens="446">
<file line="94" path="C:\+svn\SmartCard\ykt_openio\CardTools\cardreader\src\main\java\com\sungard\free\DetailPage.java"/>
<file line="85" path="C:\+svn\SmartCard\ykt_openio\CardTools\cardreader\src\main\java\com\sungard\free\ReportPage.java"/>
<codefragment>
<![CDATA[
        searchPanel.setLayout(new FlowLayout(FlowLayout.CENTER, 5, 5));

        searchPanel.add(new JLabel("开始日期："));
        startText = new JTextField(12);
        startText.setEditable(false);
        startText.setFocusable(false);
        searchPanel.add(startText);
        JButton startImg = new FreeToolbarButton(FreeUtil.getImageIcon("images/date.png"));
        searchPanel.add(startImg);
        DateChooser startDate = new DateChooser("yyyyMMdd", startText, startImg);
        searchPanel.add(new JLabel("结束日期："));
        endText = new JTextField(12);
        endText.setEditable(false);
        endText.setFocusable(false);
        searchPanel.add(endText);
        JButton endImg = new FreeToolbarButton(FreeUtil.getImageIcon("images/date.png"));
        searchPanel.add(endImg);
        DateChooser endDate = new DateChooser("yyyyMMdd", endText, endImg);
        JButton searchBtn = new JButton("查  找");
        searchBtn.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        searchBtn.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                reportAction(e);
            }
        });
        searchPanel.add(searchBtn);
    }

    private void initToolPanel() {
        this.getCenterPane().add(toolBarPanel, BorderLayout.NORTH);
        this.toolBarPanel.setLayout(new BorderLayout());
        this.toolBarPanel.setBackground(descriptionBackgroundColor);

        this.lbDescription.setForeground(descriptionTextColor);
        this.lbDescription.setBackground(descriptionBackgroundColor);
        this.lbDescription.setOpaque(true);
        this.lbDescription.setBorder(descriptionBorder);
        lbDescription.setEditable(false);
        lbDescription.setFont(FreeUtil.FONT_12_BOLD);

        toolPanel.setLayout(new FlowLayout());
        JButton excelBtn = new FreeToolbarButton(FreeUtil.getImageIcon("images/xls.gif"));
        excelBtn.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                exportAction(e);
            }
        });
        toolPanel.add(excelBtn);
        toolPanel.setBackground(descriptionBackgroundColor);

        this.toolBarPanel.add(lbDescription, BorderLayout.WEST);
        this.toolBarPanel.add(toolPanel, BorderLayout.EAST);
    }

    private void exportAction(ActionEvent e) {
        File file = ExportUtil.saveAs(this);
        try {
            if (file != null) {
                ExportUtil.exportExcel(file, this.table.getModel());
                JOptionPane.showMessageDialog(this, "导出成功", "Info", JOptionPane.INFORMATION_MESSAGE);
            }
        } catch (IOException ex) {
            logger.error(ex);
            JOptionPane.showMessageDialog(this, "导出失败", "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

    /**
     * 查找医疗付费记录
     *
     * @param e .
     */
    private void reportAction(ActionEvent e) {
        String startDate = startText.getText();
]]>
</codefragment>
</duplication>
<duplication lines="42" tokens="152">
<file line="32" path="C:\+svn\SmartCard\ykt_openio\CardTools\cardreader\src\main\java\com\sungard\util\DBUtil.java"/>
<file line="27" path="C:\+svn\SmartCard\ykt_openio\CardTools\cardreader\src\main\java\com\sungard\util\SqliteUtil.java"/>
<codefragment>
<![CDATA[
            conn = DriverManager.getConnection(jdbcUrl);
        } catch (Exception e) {
            logger.error("fail to open connection", e);
        }
        return conn;
    }

    public static void closeConnection(Connection conn) {
        if (conn != null) {
            try {
                conn.close();
            } catch (SQLException e) {
            }
        }
    }

    public static void closeStatement(Statement stmt) {
        if (stmt != null) {
            try {
                stmt.close();
            } catch (SQLException e) {
            }
        }
    }

    public static void closeResultSet(ResultSet rs) {
        if (rs != null) {
            try {
                rs.close();
            } catch (SQLException e) {
            }
        }
    }

    public static void rollback(Connection conn) {
        if (conn != null) {
            try {
                conn.rollback();
            } catch (SQLException e) {
            }
        }
    }
]]>
</codefragment>
</duplication>
<duplication lines="19" tokens="136">
<file line="38" path="C:\+svn\SmartCard\ykt_openio\CardTools\cardreader\src\main\java\com\sungard\free\DetailPage.java"/>
<file line="39" path="C:\+svn\SmartCard\ykt_openio\CardTools\cardreader\src\main\java\com\sungard\free\ReportPage.java"/>
<codefragment>
<![CDATA[
    private static final Logger logger = Logger.getLogger(ReportPage.class);
    private FreeTable table = new FreeTable();
    private JScrollPane scroll = new JScrollPane(table);
    private int descriptionHeight = 25;
    private JTextField lbDescription = new JTextField() {
        @Override
        public Dimension getPreferredSize() {
            Dimension size = super.getPreferredSize();
            return new Dimension(size.width, descriptionHeight);
        }
    };
    private Border descriptionBorder = BorderFactory.createEmptyBorder(0, FreeUtil.TABLE_CELL_LEADING_SPACE, 0, 0);
    private Color descriptionTextColor = new Color(120, 123, 154);
    private Color descriptionBackgroundColor = new Color(226, 228, 229);
    private JPanel searchPanel = new JPanel();
    private JPanel toolBarPanel = new JPanel();
    private JPanel toolPanel = new JPanel();
    private JTextField startText;
    private JTextField endText;
]]>
</codefragment>
</duplication>
<duplication lines="28" tokens="135">
<file line="191" path="C:\+svn\SmartCard\ykt_openio\CardTools\cardreader\src\main\java\com\sungard\free\DetailPage.java"/>
<file line="212" path="C:\+svn\SmartCard\ykt_openio\CardTools\cardreader\src\main\java\com\sungard\free\ReportPage.java"/>
<codefragment>
<![CDATA[
            this.setDescription("共" + result.size() + "条记录。");

        } catch (Exception ex) {
            JOptionPane.showMessageDialog(this, "查询失败", "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

    private void init() {
        initSearchPanel();
        initToolPanel();
        initTable();
        scroll.setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 0));
        this.getCenterPane().add(scroll, BorderLayout.CENTER);

        JLabel lbCorner = new JLabel();
        lbCorner.setOpaque(true);
        lbCorner.setBackground(descriptionBackgroundColor);
        this.scroll.setCorner(ScrollPaneConstants.UPPER_RIGHT_CORNER, lbCorner);
    }

    public void setDescription(String description) {
        this.lbDescription.setText(description);
    }

    public JTable getTable() {
        return table;
    }
}
]]>
</codefragment>
</duplication>
</pmd-cpd>