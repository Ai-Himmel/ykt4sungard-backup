<!doctype html public "-//W3C//DTD HTML 3.2 Draft//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-2022-jp">
<meta http-equiv="Reply-to" content="kishiyama@muratec.co.jp">
<link rel="made" href="mailto:kishiyama@muratec.co.jp">
<title>Eva(Kurumi,Lotus)Printer Tasks</title>
</head>

<body>
<h1>Printer Tasks</h1>
<h2>プリンタメイン メッセージ処理タスク</h2>
<h3>メインタスクから</h3>
<h4>MSG_PRINT_QUEUE_SET</h4>
/* Print Index Queue に登録 */<br>
MbxNo.AddIndexQueue に MSG_PRINT_QUEUE_SET を送る<p>
<h4>MSG_LIST_PRINT_QUEUE_SET</h4>
/* リストプリント開始命令 */<br>
MbxNo.AddIndexQueue に MSG_LIST_PRINT_QUEUE_SET を送る<p>
<h4>MSG_PRINT_QUEUE_FLASH</h4>
/* プリント・キュー全終了要求 */<br>
/* 最後の Index Queue 追加分をページ合成しないよう通知 */<br>
MbxNo.AddIndexQueue に MSGL_PRINT_QUEUE_FLASH を送る<p>
<h4>MSG_PRINT_SUSPEND</h4>
/* プリント中断要求 */<br>
/* Add Index Queue Task に登録待ち削除を指示 */<br>
MbxNo.AddIndexQueue にMSGL_DELETE_QUEUE<p>
/* Make Image Task に中断要求を通知 */<br>
MbxNo.MakeImage, に MSGL_DELETE_QUEUE<p>
/* Print Image Task に中断要求を通知 */<br>
MbxNo.PrintImage に MSG_PRINT_SUSPEND;<p>
<h4>MSG_TEST_PRINT</h4>
/* テストプリント起動 */<p>

<h3>インデックスキュー登録タスクから</h3>
<h4>MSGL_INDEX_QUEUE_ACK</h4>
/* プリント要求（キューに登録） */<br>
/* Make Image Task に IndexQ 追加を通知 */<br>
MbxNo.MakeImage に MSGL_INDEX_QUEUE_ACK<p>
/* Main Task に登録完了を通知 */<br>
MbxNo.Main に MSG_PRINT_QUEUE_ACK<p>
<h4>MSGL_PRINT_QUEUE_FLASH</h4>
/* Index Queue に変更あり */<br>
/* Index Queue を見るよう通知 */<br>
MbxNo.MakeImage に MSGL_PRINT_QUEUE_FLASH;<p>

<h3>イメージ作成タスクから</h3>
<h4>MSGL_DEQUEUE_INDEX</h4>
/* Image 作成終了を通知 */<br>
MbxNo.PrintImage に MSGL_DEQUEUE_INDEX<p>
/* Add Print Index Queue Task に IndexQueueに空きができたことを通知 */<br>
MbxNo.AddIndexQueue に MSGL_DEQUEUE_INDEX;<p>
<h4>MSGL_START_MAKEIMAGE</h4>
/* Image 作成開始 */<br>
/* Image 作成開始を通知 */<br>
MbxNo.PrintImage に MSGL_START_MAKEIMAGE;<p>
<h4>MSGL_DELETE_QUEUE</h4>
/* Print Image Task に Image 作成中断を通知 */<br>
MbxNo.PrintImage に MSGL_DELETE_QUEUE;<p>
<h4>MSGL_PRINT_MEM_ERROR</h4>
/* Main Task に Memory Open Error を通知 */<br>
MbxNo.Main に MSG_PRINT_MEM_ERROR<p>

<h3>イメージプリントタスクから</h3>
<h4>MSGL_PAGE_END</h4>
/* １ページ正常にプリント完了 */<br>
/* Main Task に Print 終了を通知 */<br>
MbxNo.Main に MSG_PRINT_END<p>
<h4>MSGL_SUSPEND_ACK</h4>
/* プリント中断受付 */<br>
/* Main Task にプリント中断完了を通知 */<br>
MbxNo.Main に MSG_PRINT_SUSPEND_ACK;<p>
<h4>MSGL_PRINTER_STOP</h4>
/* STOPSW でプリント終了 */<br>
/* Main Task に STOPSW でプリント終了を通知 */<br>
MbxNo.Main に MSG_PRINT_STOPSW<p>
<h4>MSGL_PRINTER_ERROR</h4>
/* エラーで停止 */<br>
/* Make Image Task に全キュー削除を通知 */<br>
MbxNo.MakeImage, に MSGL_DELETE_QUEUE<p>

<h3>プリンタ監視タスクから</h3>
<h4>MSGL_PRINTER_ERROR</h4>
/* エラーで停止 */<br>
/* Make Image Task に全キュー削除を通知 */<br>
MbxNo.MakeImage に MSGL_DELETE_QUEUE<p>
/* Print Image Task にエラーを通知 */<br>
MbxNo.PrintImage に MSGL_PRINTER_ERROR<p>
/* Main Task に エラーを通知 */<br>
MbxNo.Main に MSG_PRINT_ERROR;<p>
<h4>MSGL_PRINTER_READY</h4>
/* プリンタエラーから復帰 */<br>
/* Main Task にプリンタエラーから復帰したことを通知 */<br>
MbxNo.Main に MSG_PRINTER_READY;<p>
<h4>MSGL_PRINTER_STOP:</h4>
/* Add Index Queue Task にストップスイッチが押されたことを通知 */<br>
MbxNo.AddIndexQueue に MSGL_DELETE_QUEUE;<p>
/* Make Image Task にストップスイッチが押されたことを通知 */<br>
MbxNo.MakeImage に MSGL_DELETE_QUEUE;<p>
/* Print Image Task にストップスイッチが押されたことを通知 */<br>
MbxNo.PrintImage に MSGL_PRINTER_STOP;<p>
<hr>
<h2>インデックスキュー登録タスク</h2>
<h4>MSG_PRINT_QUEUE_SET</h4>
/* Coded Data 追加要求 */<br>
/* Queue 受付完了メッセージ */<br>
MbxNo.Printer に MSGL_INDEX_QUEUE_ACK<p>
<h4>MSG_LIST_PRINT_QUEUE_SET</h4>
/* List Print 追加要求 */<br>
/* Queue 受付完了メッセージ */<br>
MbxNo.Printer に MSGL_INDEX_QUEUE_ACK;<p>
<h4>MSGL_PRINT_QUEUE_FLASH</h4>
/* Index Queue に変更があった旨通知 */<br>
MbxNo.Printer に MSGL_PRINT_QUEUE_FLASH;<p>
<h4>MSGL_DEQUEUE_INDEX</h4>
/* Queue 受付完了メッセージ */<br>
MbxNo.Printer に MSGL_INDEX_QUEUE_ACK<p>
<h4>MSGL_DELETE_QUEUE</h4>
/* 待ちをクリア */
<hr>

<h2>イメージ作成タスク</h2>
<h4>MSGL_PRINT_QUEUE_FLASH</h4>
/* FLASH 指示を受けた */<br>
<h4>MSGL_INDEX_QUEUE_ACK</h4>
/* Index Queue に追加された */<p>
<h4>MSGL_DEQUEUE_PAGE</h4>
/* Page Memory に空きができた */<br>
イメージ作成たくす起動<p>
<h4>MSGL_DELETE_QUEUE</h4>
/* Image 作成を中断 */<br>
/* Print main Task に Image 作成中断を通知 */<br>
MbxNo.Printer に MSGL_DELETE_QUEUE;<p>
<h4>MSGL_DEQUEUE_INDEX</h4>
/* プリントイメージできた from 子タスク */<br>
イメージ作成たくす削除<br>
/* Image 作成終了と Index Queue に空きができた旨通知 */<br>
MbxNo.Printer に MSGL_DEQUEUE_INDEX;<p>
<h4>MSGL_START_MAKEIMAGE</h4>
/* Image 作成開始 from 子タスク */<br>
/* Image 作成開始を Printer Main に通知 */<br>
MbxNo.Printer に MSGL_START_MAKEIMAGE<p>
<h4>MSGL_PRINT_MEM_ERROR</h4>
/* Memory Open Error */<br>
MbxNo.Printer に MSGL_PRINT_MEM_ERROR<p>
<h3>メークイメージ子タスク</h3>
/* Image 作成開始を Make Image Task に通知 */<br>
MbxNo.MakeImage に MSGL_START_MAKEIMAGE;<p>
/* 分割プリントで次ページあり */<br>
MbxNo.PrintImage に MSGL_DIVID_PAGE;<p>
/* Decode 終了またはメモリオープンエラーを親タスクに通知 */<br>
MbxNo.MakeImage に MSGL_DEQUEUE_INDEX;<p>
<hr>

<h2>イメージプリントタスク</h2>
<h4>MSGL_START_MAKEIMAGE</h4>
/* Make Image Task が Image を 作成開始 */<br>
プリンタ起動<br>
排出終了監視タスク起動<p>
<h4>MSGL_DEQUEUE_INDEX</h4>
/* Make Image Task Image 作成を終了 */<p>
<h4>MSGL_DIVID_PAGE</h4>
/* Make Image Task 分割 Image 作成を終了 */<p>
<h4>MSGL_PRINTER_TOD</h4>
/* Page Printer TOD Signal Received */<br>
<h4>MSGL_PRINTER_DMA_END</h4>
/* Printer DMA 終了 */<br>
ページメモリの開放<p>
<h4>MSGL_PRINT_EXIT_TIMEUP</h4>
/* 排出ジャムチェック */<br>
/* Jamed */<br>
MbxNo.Printer に MSGL_PRINTER_ERROR;<p>
プリント完<br>
MbxNo.Printer にMSGL_PAGE_END<p>
エラー<br>
MbxNo.Printer に MSGL_PRINTER_ERROR<p>
サスペンド要求あり<br>
MbxNo.Printer に MSGL_SUSPEND_ACK<p>
ストップ要求あり<br>
MbxNo.Printer に MSGL_PRINTER_STOP<p>
<h4>MSG_PRINT_SUSPEND</h4>
/* 中断要求 */<p>
<h4>MSGL_PRINTER_STOP</h4>
/* ストップ */<p>
<h4>MSGL_PRINTER_ERROR</h4>
/* Printer Error */<p>
<h4>MSGL_DELETE_QUEUE</h4>
<hr>

<h2>プリンタ監視タスク</h2>
<h4>MSGL_PRINTER_ERROR</h4>
/* Printer Errorで停止 */<br>
MbxNo.Printer に MSGL_PRINTER_ERROR;<p>
<h4>MSGL_PRINTER_READY</h4>
/* プリンタエラーから復帰 */<br>
MbxNo.Printer に MSGL_PRINTER_READY<p>
<h4>MSGL_PRINTER_STOP</h4>
/* ストップスイッチ */<br>
MbxNo.Printer に MSGL_PRINTER_STOP;<p>
<hr>

<address><a href="http://jason/~members/ishiyama/">Katsunori ISHIYAMA &lt;kishiyama@muratec.co.jp&gt;</a></address>
<!-- hhmts start -->
Last modified: Thu Jul 16 23:07:14 JST 1998
<!-- hhmts end -->
</body>
</html>
