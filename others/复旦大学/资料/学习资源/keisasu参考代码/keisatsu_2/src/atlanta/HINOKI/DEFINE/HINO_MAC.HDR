;/* 以下のマクロ定義は、ＬＯＴＵＳ／ＫＵＲＵＭＩから貰ってきました。
;** 本来は、「\src\cpu\sh7043_a\irom\define\mon_mac.hdr」に中に入れるべきなのですが
;** 使用するのがＨＩＮＯＫＩだけと言うこともあり、ここにおいておきます。
;** By O.Kimoto 1998/09/24
;*/

;;/*
;;**	%W%
;;**	File Name:	\prj\Eva\Src\inc\mon_mac.hdr
;;**	Create:	1997/11/17	By Masahiro,IIDA
;;**	Description: Monitor Macro Define (ANZU_Lから変更)
;;**	Change: 19xx/xx/xx	
;;*/

IRQ_STACK_SIZE			.EQU	64
	.IMPORT	_SciIntStackArea		;;extern UDWORD SciIntStackArea[INT_STACK_SIZE/4];

;-----------------------------------------------------------------------------
;  アセンブラ マクロ定義
;-----------------------------------------------------------------------------
;-----------------------------------------------------------------------------
;  レジスタをスタックへ保存し、Stackを割込み用に変更する（割込み禁止操作なし）
;	割込ルーチンでReschedulerをコールしない場合に使用
;-----------------------------------------------------------------------------
	.MACRO	SCI_INT_STK_PUSH

	MOV.L		R0,@-R15						;PUSH.L	R0
	MOV.L		R1,@-R15						;PUSH.L	R1
	MOV			R15,R0
	MOV.L		chg_stack\@,R1
	ADD			#IRQ_STACK_SIZE,R1
	MOV.L		R1,R15					; SPを割込みルーチン用に設定
	MOV.L		R0,@-R15						;PUSH.L R0(R15)
	MOV.L		R2,@-R15						;PUSH.L R2
	MOV.L		R3,@-R15						;PUSH.L R3
	MOV.L		R4,@-R15						;PUSH.L R4
	MOV.L		R5,@-R15						;PUSH.L R5
	MOV.L		R6,@-R15						;PUSH.L R6
	MOV.L		R7,@-R15						;PUSH.L R7
	STS.L		PR,@-R15						;PUSH.L	PR
	BRA			chg_stack_end\@
	NOP

	.ALIGN 4
chg_stack\@:
	.DATA.L		_SciIntStackArea

chg_stack_end\@
	.ENDM

;-----------------------------------------------------------------------------
;  レジスタの復帰
;	割込ルーチンでReschedulerをコールしない場合に使用
;-----------------------------------------------------------------------------
	.MACRO	INT_STK_POP

	LDS.L	@R15+,PR			;POP.L	PR
	MOV.L	@R15+,R7			;POP.L	R7
	MOV.L	@R15+,R6			;POP.L	R6
	MOV.L	@R15+,R5			;POP.L	R5
	MOV.L	@R15+,R4			;POP.L	R4
	MOV.L	@R15+,R3			;POP.L	R3
	MOV.L	@R15+,R2			;POP.L	R2
	MOV.L	@R15+,R0			;POP.L	R0(R15)
	MOV		R0,R15
	MOV.L	@R15+,R1			;POP.L	R1
	MOV.L	@R15+,R0			;POP.L	R0

	.ENDM

;-----------------------------------------------------------------------------
