/*--------------------------------------------------------------------------*/
/*プロジェクト: POPLAR/ANZU_L                                               */
/*モジュ-ル名 : DEF_TCB.H                                                   */
/*作成者名 	  : 野瀬                                                        */
/*日  付   	  : 96.10.12                                                    */
/*概  要   	  : TCB定義                                                     */
/*修正履歴    :                                                             */
/*--------------------------------------------------------------------------*/
#ifndef def_tcb_h
	#define def_tcb_h	1

#include "\src\atlanta\define\message.h"

#define TCB_TBL_SIZE 	16

union wait_param_data_t {
	MESSAGE_t *sndmsg;	/* メッセージ送信待ち時、メッセージデータポインタ             */
	MESSAGE_t **rcvmsg;	/* メッセージ受信待ち時、メッセージデータポインタポインタ     */
	UWORD semno;		/* セマフォ待ち時、セマフォ番号                               */
	UWORD timer[2];		/* タイマー待ち時、０：タイマー設定値、１：タイマーカウント値 */
};

struct tcb_table_data_t {
	UBYTE tsk_stat;						/* +0 */
	UBYTE prog_no;						/* +1 */
	UBYTE priority;						/* +2 */
	UBYTE tsk_link;						/* +3 */
	UBYTE run_link;						/* +4 */
	UBYTE tsk_stat_tpo;					/* +5 */
	UWORD reserve;						/* +6 */
	union wait_param_data_t wait_param;	/* +8 */
	UDWORD *stack_addr;					/* +12 */
};

#endif


/*-----------------------------------------------------------------------------
 タスク イニシャルプログラムNo.
-----------------------------------------------------------------------------*/
#define INIT_TID		0 /* イニシャルタスクのＴＣＢオフセット */
#define TSK_INITIAL		0 /* イニシャルタスクのＴＩＢオフセット */
#define TSK_INI_ADDR	0xFFFFFC00		/* 初期化用スタック H'FFFFFC00-H'FFFFF000 3072byte */
										/* def_mon.hdr に同様の定義あり。変更は同時にする事 */

/*-----------------------------------------------------------------------------
 モニタ システム
-----------------------------------------------------------------------------*/
#define LARGE_STACK_MAX		22 /* <- 16 1997/04/24 T.Nose */
#define SMALL_STACK_MAX		44 /* <- 32 1997/04/24 T/Nose */
#define TOTAL_STACK_MAX		(SMALL_STACK_MAX+LARGE_STACK_MAX)
#define LARGE_STACK			512
#define SMALL_STACK			256
#define TASK_STACK_START	0x00805800+(LARGE_STACK_MAX*LARGE_STACK)+(SMALL_STACK_MAX*SMALL_STACK)
#define STACK_PUSH_SIZE		88 /* スタック退避 88byte使用 */
#define STACK_PC_POSITION	80
#define TOP_LARGE_ADDR 		(TASK_STACK_START-(SMALL_STACK*SMALL_STACK_MAX)-STACK_PUSH_SIZE)
#define TOP_SMALL_ADDR 		(TASK_STACK_START-STACK_PUSH_SIZE)

/***************************************************************************
 タスク ステータス
***************************************************************************/
#define WAIT				0x00
#define READY				0x40
#define NOT_USED			0xC0

#define SND_WAIT			0x01
#define RCV_WAIT			0x02
#define WAIT_SEM			0x03
#define WAIT_TIMER			0x04
#define WAIT_EVENT			0x05
#define WAIT_ONESHOT		0x06

/***************************************************************************
 セマフォ
***************************************************************************/
#define SEMNO_MAX			64 /* scb max */

/* SCB Status */
#define SCB_INIT			0x7F
#define SCB_FREE			0x3F

/***************************************************************************
 メイルボックス
***************************************************************************/
#define MBXNO_MAX			256 /* mcb max */

/* MCB Status */
#define MBX_NOT_CREATE		0xFF	/* メイルボックスがクリエイトされていない */
#define NO_WAIMBX			0x7F	/* 待ちタスク無し     */

/***************************************************************************
 イベントフラグ
***************************************************************************/
#define EVENT_MAX			256 /* ecb max */ /* T.Nose 1997/06/30 */

/***************************************************************************
 ワンショットタイマー最大値（ＭＴＵ設定に依存します)
***************************************************************************/
#define ONESHOT_VALUE_MAX	26

