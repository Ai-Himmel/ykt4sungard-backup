*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE     1
PROGRAM NAME =

    1                               1     ;/*--------------------------------------------------------------------------*/
    2                               2     ;/*  プロジェクト : POPLAR/ANZU_L                                            */
    3                               3     ;/*  ファイル名   : mon_dbg.src                                              */
    4                               4     ;/*  作成者       : 野瀬                                                     */
    5                               5     ;/*  日  付       : 1998/01/16                                               */
    6                               6     ;/*  概  要       : 割込み禁止区間測定のため、モニターコールに飛ぶ前に       */
    7                               7     ;                   ポート（Ｃ２０３Ｄ０）の０ｘ００２０をＯＮします         */
    8                               8     ;                   POPLAR_B のみ使用                                        */
    9                               9     ;/*  修正履歴     :                                                          */
   10                              10     ;/*--------------------------------------------------------------------------*/
   11                              11             .INCLUDE        "\src\atlanta\sh7043\define\def_mon.hdr"
   12                               1 I1  ;/*--------------------------------------------------------------------------*/
   13                               2 I1  ;/*  プロジェクト : RISC                                                     */
   14                               3 I1  ;/*  ファイル名   : def_mon.ih                                               */
   15                               4 I1  ;/*  作成者       : 野瀬                                                     */
   16                               5 I1  ;/*  日  付       : 95.11.01                                                 */
   17                               6 I1  ;/*  概  要       : モニタdefine定義                                         */
   18                               7 I1  ;/*  修正履歴     :                                                          */
   19                               8 I1  ;/*--------------------------------------------------------------------------*/
   20                               9 I1  ;-----------------------------------------------------------------------------
   21                              10 I1  ; ＣＣＲ マスクビット
   22                              11 I1  ;-----------------------------------------------------------------------------
   23          000000F0            12 I1  I_BIT_ON                .EQU    H'000000F0      ; 割込禁止 RISC
   24          0000030F            13 I1  I_BIT_OFF               .EQU    H'0000030F      ; 割込許可 RISC
   25                              14 I1  
   26                              15 I1  ;-----------------------------------------------------------------------------
   27                              16 I1  ; ワンショットタイマ値ＭＡＸ
   28                              17 I1  ;-----------------------------------------------------------------------------
   29          0000001A            18 I1  ONESHOT_VALUE_MAX               .EQU    26
   30                              19 I1  
   31                              20 I1  ;-----------------------------------------------------------------------------
   32                              21 I1  ; タスク イニシャルプログラムNo.
   33                              22 I1  ;-----------------------------------------------------------------------------
   34          00000000            23 I1  INIT_TID                .EQU    0
   35          00000000            24 I1  TSK_INITIAL             .EQU    0
   36          FFFFFC00            25 I1  TSK_INI_ADDR    .EQU    H'FFFFFC00              ; 初期化用スタック H'FFFFFC00-H'FFFFF000 3
   37                              26 I1                                                                                  ; def_mon.
   38                              27 I1  
   39                              28 I1  ;-----------------------------------------------------------------------------
   40                              29 I1  ; モニタ システム
   41                              30 I1  ;-----------------------------------------------------------------------------
   42                              31 I1  
   43          00000000            32 I1  FLAG_INIT_DATA                  .EQU    H'00000000      ; RISC
   44                              33 I1  
   45                              34 I1  ;TASK_STACK_START               .EQU    H'00809800
   46                              35 I1  
   47                              36 I1  ;LARGE_STACK_MAX                        .EQU    16                      ; RISC
   48                              37 I1  ;SMALL_STACK_MAX                        .EQU    32                      ; RISC
   49                              38 I1  ;TOTAL_STACK_MAX                        .EQU    (SMALL_STACK_MAX+LARGE_STACK_MAX)
   50                              39 I1  ;LARGE_STACK                            .EQU    512
   51                              40 I1  ;SMALL_STACK                            .EQU    256
   52                              41 I1  ;STACK_PUSH_SIZE                        .EQU    88                      ;       スタック退
   53                              42 I1  ;TOP_LARGE_ADDR                         .EQU    (TASK_STACK_START-(SMALL_STACK*SMALL_STACK
   54                              43 I1  ;TOP_SMALL_ADDR                         .EQU    (TASK_STACK_START-STACK_PUSH_SIZE)
   55          00000050            44 I1  STACK_PC_POSITION               .EQU    80
   56                              45 I1  ;STK_RTNVL_PT                   .EQU    76
   57                              46 I1  
*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE     2
PROGRAM NAME =

   58                              47 I1  ;-----------------------------------------------------------------------------
   59                              48 I1  ; TIB
   60                              49 I1  ;
   61                              50 I1  ; struct tib_table_data {
   62                              51 I1  ;       unsigned char *start_addr;
   63                              52 I1  ;       unsigned char *end_addr;
   64                              53 I1  ;       unsigned char stack_size;
   65                              54 I1  ;       unsigned char priority;
   66                              55 I1  ;       unsigned short reserve;
   67                              56 I1  ; };
   68                              57 I1  ;
   69                              58 I1  ;    ｮ｢｢｢｢｢｢｢｢｢｢｢ｲ
   70                              59 I1  ;  0 ､                      ､
   71                              60 I1  ;    ､                      ､
   72                              61 I1  ;  1 ､   タスクプログラム   ､
   73                              62 I1  ;    ､   スタートアドレス   ､
   74                              63 I1  ;  2 ､                      ､
   75                              64 I1  ;    ､                      ､
   76                              65 I1  ;  3 ､                      ､
   77                              66 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
   78                              67 I1  ;  4 ､                      ､
   79                              68 I1  ;    ､                      ､
   80                              69 I1  ;  5 ､   異常処理ルーチン   ､
   81                              70 I1  ;    ､   スタートアドレス   ､
   82                              71 I1  ;  6 ､                      ､
   83                              72 I1  ;    ､                      ､
   84                              73 I1  ;  7 ､                      ､
   85                              74 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
   86                              75 I1  ;  8 ､    スタックサイズ    ､  0:Large Stack  1:Small Stack
   87                              76 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
   88                              77 I1  ;  9 ､       優先順位       ､
   89                              78 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
   90                              79 I1  ; 10 ､       リザーブ       ､
   91                              80 I1  ;    ､                      ､
   92                              81 I1  ; 11 ､                      ､
   93                              82 I1  ;    ｶ｢｢｢｢｢｢｢｢｢｢｢ｺ
   94                              83 I1  ;
   95                              84 I1  ;      優先順位(0～255)
   96                              85 I1  ;      ※ 0を最も高い優先順位とします
   97                              86 I1  ;-----------------------------------------------------------------------------
   98                              87 I1  
   99          0000000C            88 I1  TIB_TBL_SIZE    .EQU    12
  100                              89 I1  
  101                              90 I1  ;-- オフセット --
  102          00000000            91 I1  TIB_START_ADR           .EQU    0
  103          00000004            92 I1  TIB_END_ADR                     .EQU    4
  104          00000008            93 I1  TIB_STACK_SIZE          .EQU    8
  105          00000009            94 I1  TIB_PRIORITY            .EQU    9
  106                              95 I1  
  107                              96 I1  ;-----------------------------------------------------------------------------
  108                              97 I1  ; TCB
  109                              98 I1  ;
  110                              99 I1  ; struct tcb_table_data {
  111                             100 I1  ;       unsigned char tsk_stat;
  112                             101 I1  ;       unsigned char prog_no;
  113                             102 I1  ;       unsigned char priority;
  114                             103 I1  ;       unsigned char tsk_link;
*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE     3
PROGRAM NAME =

  115                             104 I1  ;       unsigned char run_link;
  116                             105 I1  ;       unsigned char tsk_stat_tpo;
  117                             106 I1  ;       unsigned short reserve;         RISC追加 by T.Nose
  118                             107 I1  ;       unsigned long wait_param;
  119                             108 I1  ;       unsigned char *stack_addr;
  120                             109 I1  ; };
  121                             110 I1  ;
  122                             111 I1  ;    ｮ｢｢ﾎ｢｢｢｢｢｢｢｢ｲ
  123                             112 I1  ;  0 ､STS ､ WAIT時の原因   ､   STS           WAIT時の原因
  124                             113 I1  ;    ｾ｢｢ﾖ｢｢｢｢｢｢｢｢ﾆ   11 : 未使用    1 : 送信待ち
  125                             114 I1  ;  1 ､     プログラムNo.    ､   00 : WAIT      2 : 受信待ち
  126                             115 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ   01 : READY     3 : セマフォ待ち
  127                             116 I1  ;  2 ､       優先順位       ､                  4 : タイマ待ち
  128                             117 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ                  5 : イベントフラグ待ち
  129                             118 I1  ;  3 ､     タスクリンク     ､                  6 : ワンショットタイマ待ち
  130                             119 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
  131                             120 I1  ;  4 ､    強制ランタスク    ､
  132                             121 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
  133                             122 I1  ;  5 ､待ちタスクパラメータ a､
  134                             123 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
  135                             124 I1  ;  6 ､       リザーブ       ､  アドレス調整用 RISC追加 by T.Nose
  136                             125 I1  ;    ､                      ､
  137                             126 I1  ;  7 ､                      ､
  138                             127 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
  139                             128 I1  ;  8 ､                     b､  1.送信待ち
  140                             129 I1  ;    ､                      ､     a     : MBX No
  141                             130 I1  ;  9 ､                     c､     b～e  : 送信データアドレス
  142                             131 I1  ;    ､                      ､  2.受信待ち
  143                             132 I1  ; 10 ､                     d､     a     : MBX No
  144                             133 I1  ;    ､                      ､     b～e  : 受信データアドレス
  145                             134 I1  ; 11 ､                     e､  3.セマフォ待ち
  146                             135 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ     a,d,e : 未使用
  147                             136 I1  ; 12 ､                      ､     b,c   : セマフォ No
  148                             137 I1  ;    ､                      ､  4.タイマ待ち
  149                             138 I1  ; 13 ､                      ､     a,d,e : 未使用
  150                             139 I1  ;    ､   スタックアドレス   ､     b,c   : タイマ値
  151                             140 I1  ; 14 ､                      ､  5.イベントフラグ待ち
  152                             141 I1  ;    ､                      ､     a     : EVENT No
  153                             142 I1  ; 15 ､                      ､     b～e  : 未使用
  154                             143 I1  ;    ｶ｢｢｢｢｢｢｢｢｢｢｢ｺ  6.ワンショットタイマ待ち
  155                             144 I1  ;                                   a～e  : 未使用
  156                             145 I1  
  157                             146 I1  
  158                             147 I1  
  159                             148 I1  
  160                             149 I1  ;      スタックアドレス  初期値 = (実際のアドレス - 32byte)
  161                             150 I1  ;
  162                             151 I1  ;-----------------------------------------------------------------------------
  163                             152 I1  
  164                             153 I1  ;-- オフセット --
  165          00000000           154 I1  TCB_STAT                        .EQU    0
  166          00000001           155 I1  TCB_PROGNO                      .EQU    1
  167          00000002           156 I1  TCB_PRIORITY            .EQU    2
  168          00000003           157 I1  TCB_LINK                        .EQU    3
  169          00000004           158 I1  TCB_RUN_LINK            .EQU    4
  170          00000005           159 I1  TCB_WAIT_PARAM          .EQU    5
  171          00000006           160 I1  TCB_RESERVE                     .EQU    6
*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE     4
PROGRAM NAME =

  172          00000008           161 I1  TCB_WAIT_PARA1          .EQU    8
  173          0000000A           162 I1  TCB_WAIT_PARA2          .EQU    10
  174          0000000C           163 I1  TCB_STACK_ADR           .EQU    12
  175                             164 I1  
  176                             165 I1  ;READY_TSK_MAX  .EQU    SMALL_STACK_MAX+LARGE_STACK_MAX
  177          00000010           166 I1  TCB_TBL_SIZE    .EQU    16
  178                             167 I1  
  179          000000FF           168 I1  NIL                             .EQU    H'ff
  180          0000FFFF           169 I1  WORDNIL                 .EQU    H'ffff
  181          FFFFFFFF           170 I1  LONGNIL                 .EQU    H'ffffffff
  182                             171 I1  
  183          00000000           172 I1  WAIT                    .EQU    H'00    ;RISC
  184          00000040           173 I1  READY                   .EQU    H'40    ;RISC
  185          000000C0           174 I1  NOT_USED                .EQU    H'C0    ;RISC
  186                             175 I1  
  187          00000001           176 I1  SND_WAIT                .EQU    H'01
  188          00000002           177 I1  RCV_WAIT                .EQU    H'02
  189          00000003           178 I1  WAIT_SEM                .EQU    H'03
  190          00000004           179 I1  WAIT_TIMER              .EQU    H'04
  191          00000005           180 I1  WAIT_EVENT              .EQU    H'05
  192          00000006           181 I1  WAIT_ONESHOT    .EQU    H'06
  193                             182 I1  
  194          000000FF           183 I1  ERROR                   .EQU    H'ff
  195                             184 I1  
  196                             185 I1  ;-----------------------------------------------------------------------------
  197                             186 I1  ; SCB
  198                             187 I1  ;
  199                             188 I1  ; struct scb_table_data {
  200                             189 I1  ;       unsigned char stat;
  201                             190 I1  ;       unsigned char tid;
  202                             191 I1  ; };
  203                             192 I1  ;
  204                             193 I1  ;    ｮ｢｢ﾎ｢｢｢｢｢｢｢｢ｲ
  205                             194 I1  ;  0 ､STS ､待ちタスクのTID ､
  206                             195 I1  ;    ｾ｢｢ﾖ｢｢｢｢｢｢｢｢ﾆ
  207                             196 I1  ;  1 ､   セマフォ獲得TID    ､
  208                             197 I1  ;    ｶ｢｢｢｢｢｢｢｢｢｢｢ｺ
  209                             198 I1  ;
  210                             199 I1  ;     STS
  211                             200 I1  ;          11 : 未使用
  212                             201 I1  ;          00 : セマフォ値=0
  213                             202 I1  ;          01 : セマフォ値=1
  214                             203 I1  ;
  215                             204 I1  ;     待ちタスクのTID
  216                             205 I1  ;          111111 : 待ちタスクなし
  217                             206 I1  ;
  218                             207 I1  ;-----------------------------------------------------------------------------
  219                             208 I1  
  220                             209 I1  ;SEMNO_MAX              .EQU    32
  221          00000002           210 I1  SCB_TBL_SIZE    .EQU    2
  222          0000007F           211 I1  SCB_INIT                .EQU    H'7F
  223                             212 I1  ;SCB_FREE               .EQU    H'3F
  224                             213 I1  
  225                             214 I1  ;MAX_SEMNO              .EQU    15      ; \src\atlanta\sh7043\define\def_semn.hに
  226                             215 I1                                                          ; 同一の定義有り。同値に保って下さ
  227                             216 I1  
  228                             217 I1  ;-- オフセット --
*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE     5
PROGRAM NAME =

  229          00000000           218 I1  SCB_STAT                .EQU    0
  230          00000001           219 I1  SCB_TID                 .EQU    1
  231                             220 I1  
  232                             221 I1  ;-----------------------------------------------------------------------------
  233                             222 I1  ; MCB
  234                             223 I1  ;
  235                             224 I1  ;    ｮ｢｢ﾎ｢｢｢｢｢｢ｲ
  236                             225 I1  ;    ､STS ､    TID     ､
  237                             226 I1  ;    ｶ｢｢ﾖ｢｢｢｢｢｢ｺ
  238                             227 I1  ;
  239                             228 I1  ;     STS                      TID
  240                             229 I1  ;     11 : 未使用              111111
  241                             230 I1  ;     10 : 待ちタスクなし      111111
  242                             231 I1  ;     00 : 送信待ちタスクあり  xxxxxx  待ちタスクの中で最も優先順位の高いTID
  243                             232 I1  ;     01 : 受信待ちタスクあり  xxxxxx  待ちタスクの中で最も優先順位の高いTID
  244                             233 I1  ;
  245                             234 I1  ;-----------------------------------------------------------------------------
  246                             235 I1  
  247                             236 I1  ;MBXNO_MAX              .EQU    256
  248                             237 I1  
  249                             238 I1  ;Task MAX Change T.Nose 1996/10/31
  250          0000007F           239 I1  NO_WAIMBX               .EQU    H'7F    ;<- H'BF
  251                             240 I1  ;SND_MBX                        .EQU    H'00
  252                             241 I1  ;RCV_MBX                        .EQU    H'40
  253                             242 I1  
  254                             243 I1  ;MAX_MBXNO              .EQU    70      ; \src\atlanta\sh7043\define\def_mbxn.h に
  255                             244 I1                                                          ; 同一の定義有り。同値に保って下さ
  256                             245 I1  
  257                             246 I1  ;-----------------------------------------------------------------------------
  258                             247 I1  ; ECB
  259                             248 I1  ;
  260                             249 I1  ;    ｮ｢｢｢｢｢｢｢｢｢ｲ
  261                             250 I1  ;    ､       TID        ､
  262                             251 I1  ;    ｶ｢｢｢｢｢｢｢｢｢ｺ
  263                             252 I1  ;
  264                             253 I1  ;     TID
  265                             254 I1  ;     11111111 : 待ちタスクなし
  266                             255 I1  ;     xxxxxxxx : 待ちタスクのTID
  267                             256 I1  ;
  268                             257 I1  ;-----------------------------------------------------------------------------
  269                             258 I1  
  270                             259 I1  ;;EVENT_MAX             .EQU    74
  271                             260 I1  ;EVENT_MAX              .EQU    94     ; Changed with def_evtn.h for R288F event by H.Kubo
  272                             261 I1  
  273                             262 I1  ;-----------------------------------------------------------------------------
  274                             263 I1  ; Ｃソースモニター用
  275                             264 I1  ;-----------------------------------------------------------------------------
  276          00000001           265 I1  MON_SUCCESS             .EQU    1       ;モニター本体処理の戻値（結果）
  277          00000000           266 I1  MON_FAILURE             .EQU    0
  278                             267 I1  
  279                              12             .INCLUDE        "\src\atlanta\sh7043\ext_v\extv_mon.hdr"
  280                               1 I1  ;/*--------------------------------------------------------------------------*/
  281                               2 I1  ;/*  プロジェクト : POPLAR/ANZU_L                                            */
  282                               3 I1  ;/*  ファイル名   : extv_mon.hdr                                             */
  283                               4 I1  ;/*  作成者       : 野瀬敏弘                                                 */
  284                               5 I1  ;/*  日  付       : 1996/10/14                                               */
  285                               6 I1  ;/*  概  要       : モニタテーブル外部参照                                   */
*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE     6
PROGRAM NAME =

  286                               7 I1  ;/*  修正履歴     :                                                          */
  287                               8 I1  ;/*--------------------------------------------------------------------------*/
  288                               9 I1  
  289                              10 I1          .IMPORT         _real_run_tid
  290                              11 I1          .IMPORT         _top_ready_tid
  291                              12 I1          .IMPORT         _wai_tsk_tid
  292                              13 I1          .IMPORT         _wai_1shot_tid
  293                              14 I1          .IMPORT         _tib
  294                              15 I1          .IMPORT         _tcb_p
  295                              16 I1          .IMPORT         _scb_p
  296                              17 I1          .IMPORT         _ecb_p
  297                              18 I1          .IMPORT         _mcb_p
  298                              19 I1          .IMPORT         _MON_StackCheckTable_p
  299                              20 I1          .IMPORT         _MON_MAX_LARGE_TCB
  300                              21 I1          .IMPORT         _MON_MAX_SMALL_TCB
  301                              22 I1          .IMPORT         _MON_MAX_TCB
  302                              23 I1          .IMPORT         _MON_SIZE_LARGE_STACK
  303                              24 I1          .IMPORT         _MON_SIZE_SMALL_STACK
  304                              25 I1          .IMPORT         _MON_STACK_START_ADDR
  305                              26 I1          .IMPORT         _MON_TOP_LARGE_ADDR
  306                              27 I1          .IMPORT         _MON_TOP_SMALL_ADDR
  307                              28 I1          .IMPORT         _MON_MAX_SCB
  308                              29 I1          .IMPORT         _MON_MAX_SEMNO
  309                              30 I1          .IMPORT         _MON_MAX_MCB
  310                              31 I1          .IMPORT         _MON_MAX_MBXNO
  311                              32 I1          .IMPORT         _MON_MAX_ECB
  312                              33 I1  
  313                              34 I1  ; 以下の外部参照宣言は後程削除します
  314                              35 I1  ;       .IMPORT         _MON_DebugSwitch
  315                              36 I1  ;       .IMPORT         _tcb
  316                              37 I1  ;       .IMPORT         _scb
  317                              38 I1  ;       .IMPORT         _ecb
  318                              39 I1  ;       .IMPORT         _mcb
  319                              13     
  320                              14             .IMPORT         _del_tsk_irom
  321                              15             .IMPORT         _chk_mbx_irom
  322                              16             .IMPORT         _chk_rcv_irom
  323                              17             .IMPORT         _idet_evt_irom
  324                              18             .IMPORT         _Timer_int_irom
  325                              19             .IMPORT         _Oneshot_int_irom
  326                              20             .IMPORT         monitor_error
  327                              21     
  328                              22             .EXPORT         _del_tsk_int
  329                              23             .EXPORT         _chk_mbx_int
  330                              24             .EXPORT         _chk_rcv_int
  331                              25             .EXPORT         _idet_evt_int
  332                              26             .EXPORT         _Timer_int
  333                              27             .EXPORT         _Oneshot_int
  334                              28     
  335 00000000                     29             .SECTION        P,CODE,ALIGN=4
  336 00000000                     30     _del_tsk_int:
  337 00000000 4F22                31             STS.L   PR,@-R15                                ; PUSH.L        PR
  338                              32     
  339                              33     ;;;;del_tskのバグをここで吸収します
  340 00000002 2F06                34             MOV.L   R0,@-R15
  341 00000004 2F16                35             MOV.L   R1,@-R15
  342 00000006 2F26                36             MOV.L   R2,@-R15
*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE     7
PROGRAM NAME =

  343                              37     ;割込み禁止にしておく
  344 00000008 0002                38             STC             SR,R0
  345 0000000A D10C                39             MOV.L   DEL_TSK+4,R1
  346 0000000C 201B                40             OR              R1,R0
  347 0000000E 400E                41             LDC             R0,SR
  348                              42     ;tsk_id MAXチェック
  349 00000010 6041                43             MOV.W   @R4,R0
  350 00000012 D10B                44             MOV.L   DEL_TSK+8,R1
  351 00000014 600D                45             EXTU.W  R0,R0
  352 00000016 6210                46             MOV.B   @R1,R2
  353 00000018 622C                47             EXTU.B  R2,R2
  354 0000001A 3022                48             CMP/HS  R2,R0
  355 0000001C 8912                49             BT              DEL_TSK_ERR                             ;tsk_id(R0) >= MON_MAX_TCB
  356 0000001E 62F6                50             MOV.L   @R15+,R2
  357 00000020 61F6                51             MOV.L   @R15+,R1
  358 00000022 60F6                52             MOV.L   @R15+,R0
  359                              53     ;イベント待ちタスク削除の場合のため
  360 00000024 2FA6                54             MOV.L   R10,@-R15                               ; PUSH.L        R10
  361 00000026 EAFF                55             MOV             #NIL,R10
  362                              56     ;;;;ここまで
  363                              57     
  364 00000028 D003                58             MOV.L   DEL_TSK,R0
  365 0000002A 400B                59             JSR             @R0
  366 0000002C 0009                60             NOP
  367 0000002E 6AF6                61             MOV.L   @R15+,R10                               ; POP.L         R10
  368 00000030 4F26                62             LDS.L   @R15+,PR                                ; POP.L         PR
  369 00000032 000B                63             RTS
  370 00000034 0009                64             NOP
  371 00000038                     65             .ALIGN 4
  372 00000038                     66     DEL_TSK:
  373 00000038 00000000            67             .DATA.L         _del_tsk_irom
  374 0000003C 000000F0            68             .DATA.L         I_BIT_ON
  375 00000040 00000000            69             .DATA.L         _MON_MAX_TCB
  376 00000044                     70     DEL_TSK_ERR:
  377 00000044 D001                71             MOV.L   MON_ERR,R0
  378 00000046 402B                72             JMP             @R0
  379 00000048 0009                73             NOP
  380 0000004C                     74             .ALIGN 4
  381 0000004C                     75     MON_ERR:
  382 0000004C 00000000            76             .DATA.L         monitor_error
  383                              77     
  384 00000050                     78     _chk_mbx_int:
  385 00000050 4F22                79             STS.L   PR,@-R15                                ; PUSH.L        PR
  386 00000052 4F12                80             STS.L   MACL,@-R15                              ; PUSH.L        MACL chk_mbxのバグ
  387 00000054 D003                81             MOV.L   CHK_MBX,R0
  388 00000056 400B                82             JSR             @R0
  389 00000058 0009                83             NOP
  390 0000005A 4F16                84             LDS.L   @R15+,MACL                              ; POP.L         MACL chk_mbxのバグ
  391 0000005C 4F26                85             LDS.L   @R15+,PR                                ; POP.L         PR
  392 0000005E 000B                86             RTS
  393 00000060 0009                87             NOP
  394 00000064                     88             .ALIGN 4
  395 00000064                     89     CHK_MBX:
  396 00000064 00000000            90             .DATA.L         _chk_mbx_irom
  397                              91     
  398 00000068                     92     _chk_rcv_int:
  399 00000068 4F22                93             STS.L   PR,@-R15                                ; PUSH.L        PR
*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE     8
PROGRAM NAME =

  400 0000006A 4F12                94             STS.L   MACL,@-R15                              ; PUSH.L        MACL chk_rcvのバグ
  401 0000006C D003                95             MOV.L   CHK_RCV,R0
  402 0000006E 400B                96             JSR             @R0
  403 00000070 0009                97             NOP
  404 00000072 4F16                98             LDS.L   @R15+,MACL                              ; POP.L         MACL chk_rcvのバグ
  405 00000074 4F26                99             LDS.L   @R15+,PR                                ; POP.L         PR
  406 00000076 000B               100             RTS
  407 00000078 0009               101             NOP
  408 0000007C                    102             .ALIGN 4
  409 0000007C                    103     CHK_RCV:
  410 0000007C 00000000           104             .DATA.L         _chk_rcv_irom
  411                             105     
  412 00000080                    106     _idet_evt_int:
  413 00000080 4F22               107             STS.L   PR,@-R15                                ; PUSH.L        PR
  414 00000082 4F12               108             STS.L   MACL,@-R15                              ; PUSH.L        MACL idet_evtのバ
  415 00000084 D003               109             MOV.L   IDET_EVT,R0
  416 00000086 400B               110             JSR             @R0
  417 00000088 0009               111             NOP
  418 0000008A 4F16               112             LDS.L   @R15+,MACL                              ; POP.L         MACL chk_mbxのバグ
  419 0000008C 4F26               113             LDS.L   @R15+,PR                                ; POP.L         PR
  420 0000008E 000B               114             RTS
  421 00000090 0009               115             NOP
  422 00000094                    116             .ALIGN 4
  423 00000094                    117     IDET_EVT:
  424 00000094 00000000           118             .DATA.L         _idet_evt_irom
  425                             119     
  426 00000098                    120     _Timer_int:
  427 00000098 4F22               121             STS.L   PR,@-R15                                ; PUSH.L        PR
  428 0000009A 4F12               122             STS.L   MACL,@-R15                              ; PUSH.L        MACL Timer_int_iro
  429 0000009C 2F86               123             MOV.L   R8,@-R15                                ; PUSH.L        R8      Timer_int_
  430 0000009E 2F96               124             MOV.L   R9,@-R15                                ; PUSH.L        R9      Timer_int_
  431 000000A0 D004               125             MOV.L   TIMER_INT,R0
  432 000000A2 400B               126             JSR             @R0
  433 000000A4 0009               127             NOP
  434 000000A6 69F6               128             MOV.L   @R15+,R9                                ; POP.L         R9      Timer_int_
  435 000000A8 68F6               129             MOV.L   @R15+,R8                                ; POP.L         R8      Timer_int_
  436 000000AA 4F16               130             LDS.L   @R15+,MACL                              ; POP.L         MACL Timer_int_iro
  437 000000AC 4F26               131             LDS.L   @R15+,PR                                ; POP.L         PR
  438 000000AE 000B               132             RTS
  439 000000B0 0009               133             NOP
  440 000000B4                    134             .ALIGN 4
  441 000000B4                    135     TIMER_INT:
  442 000000B4 00000000           136             .DATA.L         _Timer_int_irom
  443                             137     
  444 000000B8                    138     _Oneshot_int:
  445 000000B8 4F22               139             STS.L   PR,@-R15                ; PUSH.L        PR
  446 000000BA 4F12               140             STS.L   MACL,@-R15              ; PUSH.L        MACL    Oneshot_int_iromのバグ吸収
  447 000000BC 2F86               141             MOV.L   R8,@-R15                ; PUSH.L        R8              Oneshot_int_iromの
  448 000000BE 2F96               142             MOV.L   R9,@-R15                ; PUSH.L        R9              Oneshot_int_iromの
  449 000000C0 2FA6               143             MOV.L   R10,@-R15               ; PUSH.L        R10             Oneshot_int_iromの
  450 000000C2 D005               144             MOV.L   ONESHOT_INT,R0
  451 000000C4 400B               145             JSR             @R0
  452 000000C6 0009               146             NOP
  453 000000C8 6AF6               147             MOV.L   @R15+,R10               ; POP.L         R10             Oneshot_int_iromの
  454 000000CA 69F6               148             MOV.L   @R15+,R9                ; POP.L         R9              Oneshot_int_iromの
  455 000000CC 68F6               149             MOV.L   @R15+,R8                ; POP.L         R8              Oneshot_int_iromの
  456 000000CE 4F16               150             LDS.L   @R15+,MACL              ; POP.L         MACL    Oneshot_int_iromのバグ吸収
*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE     9
PROGRAM NAME =

  457 000000D0 4F26               151             LDS.L   @R15+,PR                ; POP.L         PR
  458 000000D2 000B               152             RTS
  459 000000D4 0009               153             NOP
  460 000000D8                    154             .ALIGN 4
  461 000000D8                    155     ONESHOT_INT:
  462 000000D8 00000000           156             .DATA.L         _Oneshot_int_irom
  463                             157     
  464                             158             .END
  *****TOTAL ERRORS       0
  *****TOTAL WARNINGS     0
*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE    10

*** CROSS REFERENCE LIST

NAME                             SECTION  ATTR VALUE             SEQUENCE

CHK_MBX                          P             00000064    387   395*
CHK_RCV                          P             0000007C    401   409*
DEL_TSK                          P             00000038    345   350   364   372*
DEL_TSK_ERR                      P             00000044    355   376*
ERROR                                     EQU  000000FF    194*
FLAG_INIT_DATA                            EQU  00000000     43*
IDET_EVT                         P             00000094    415   423*
INIT_TID                                  EQU  00000000     34*
I_BIT_OFF                                 EQU  0000030F     24*
I_BIT_ON                                  EQU  000000F0     23*  374 
LONGNIL                                   EQU  FFFFFFFF    181*
MON_ERR                          P             0000004C    377   381*
MON_FAILURE                               EQU  00000000    277*
MON_SUCCESS                               EQU  00000001    276*
NIL                                       EQU  000000FF    179*  361 
NOT_USED                                  EQU  000000C0    185*
NO_WAIMBX                                 EQU  0000007F    250*
ONESHOT_INT                      P             000000D8    450   461*
ONESHOT_VALUE_MAX                         EQU  0000001A     29*
P                                P        SCT  00000000    335*
RCV_WAIT                                  EQU  00000002    188*
READY                                     EQU  00000040    184*
SCB_INIT                                  EQU  0000007F    222*
SCB_STAT                                  EQU  00000000    229*
SCB_TBL_SIZE                              EQU  00000002    221*
SCB_TID                                   EQU  00000001    230*
SND_WAIT                                  EQU  00000001    187*
STACK_PC_POSITION                         EQU  00000050     55*
TCB_LINK                                  EQU  00000003    168*
TCB_PRIORITY                              EQU  00000002    167*
TCB_PROGNO                                EQU  00000001    166*
TCB_RESERVE                               EQU  00000006    171*
TCB_RUN_LINK                              EQU  00000004    169*
TCB_STACK_ADR                             EQU  0000000C    174*
TCB_STAT                                  EQU  00000000    165*
TCB_TBL_SIZE                              EQU  00000010    177*
TCB_WAIT_PARA1                            EQU  00000008    172*
TCB_WAIT_PARA2                            EQU  0000000A    173*
TCB_WAIT_PARAM                            EQU  00000005    170*
TIB_END_ADR                               EQU  00000004    103*
TIB_PRIORITY                              EQU  00000009    105*
TIB_STACK_SIZE                            EQU  00000008    104*
TIB_START_ADR                             EQU  00000000    102*
TIB_TBL_SIZE                              EQU  0000000C     99*
TIMER_INT                        P             000000B4    431   441*
TSK_INITIAL                               EQU  00000000     35*
TSK_INI_ADDR                              EQU  FFFFFC00     36*
WAIT                                      EQU  00000000    183*
WAIT_EVENT                                EQU  00000005    191*
WAIT_ONESHOT                              EQU  00000006    192*
WAIT_SEM                                  EQU  00000003    189*
WAIT_TIMER                                EQU  00000004    190*
WORDNIL                                   EQU  0000FFFF    180*
_MON_MAX_ECB                              IMPT 00000000    311 
*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE    11

*** CROSS REFERENCE LIST

NAME                             SECTION  ATTR VALUE             SEQUENCE

_MON_MAX_LARGE_TCB                        IMPT 00000000    299 
_MON_MAX_MBXNO                            IMPT 00000000    310 
_MON_MAX_MCB                              IMPT 00000000    309 
_MON_MAX_SCB                              IMPT 00000000    307 
_MON_MAX_SEMNO                            IMPT 00000000    308 
_MON_MAX_SMALL_TCB                        IMPT 00000000    300 
_MON_MAX_TCB                              IMPT 00000000    301   375 
_MON_SIZE_LARGE_STACK                     IMPT 00000000    302 
_MON_SIZE_SMALL_STACK                     IMPT 00000000    303 
_MON_STACK_START_ADDR                     IMPT 00000000    304 
_MON_StackCheckTable_p                    IMPT 00000000    298 
_MON_TOP_LARGE_ADDR                       IMPT 00000000    305 
_MON_TOP_SMALL_ADDR                       IMPT 00000000    306 
_Oneshot_int                     P        EXPT 000000B8    333   444*
_Oneshot_int_irom                         IMPT 00000000    325   462 
_Timer_int                       P        EXPT 00000098    332   426*
_Timer_int_irom                           IMPT 00000000    324   442 
_chk_mbx_int                     P        EXPT 00000050    329   384*
_chk_mbx_irom                             IMPT 00000000    321   396 
_chk_rcv_int                     P        EXPT 00000068    330   398*
_chk_rcv_irom                             IMPT 00000000    322   410 
_del_tsk_int                     P        EXPT 00000000    328   336*
_del_tsk_irom                             IMPT 00000000    320   373 
_ecb_p                                    IMPT 00000000    296 
_idet_evt_int                    P        EXPT 00000080    331   412*
_idet_evt_irom                            IMPT 00000000    323   424 
_mcb_p                                    IMPT 00000000    297 
_real_run_tid                             IMPT 00000000    289 
_scb_p                                    IMPT 00000000    295 
_tcb_p                                    IMPT 00000000    294 
_tib                                      IMPT 00000000    293 
_top_ready_tid                            IMPT 00000000    290 
_wai_1shot_tid                            IMPT 00000000    292 
_wai_tsk_tid                              IMPT 00000000    291 
monitor_error                             IMPT 00000000    326   382 
*** SH SERIES ASSEMBLER Ver. 2.0 ***      02/03/98 17:09:47                                                              PAGE    12

*** SECTION DATA LIST

SECTION                          ATTRIBUTE    SIZE             START

P                                REL-CODE    0000000DC        
