*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE     1
PROGRAM NAME =

    1                               1     ;/*--------------------------------------------------------------------------*/
    2                               2     ;/*  プロジェクト : POPLAR/ANZU_L                                            */
    3                               3     ;/*  ファイル名   : cre_tsk.src                                              */
    4                               4     ;/*  作成者       : 野瀬                                                     */
    5                               5     ;/*  日  付       : 1996/10/14                                               */
    6                               6     ;/*  概  要       : タスクの生成                                             */
    7                               7     ;/*  修正履歴     :                                                          */
    8                               8     ;/*--------------------------------------------------------------------------*/
    9                               9     
   10                              10             .INCLUDE        "\src\atlanta\sh7043\define\def_mon.hdr"
   11                               1 I1  ;/*--------------------------------------------------------------------------*/
   12                               2 I1  ;/*  プロジェクト : RISC                                                     */
   13                               3 I1  ;/*  ファイル名   : def_mon.ih                                               */
   14                               4 I1  ;/*  作成者       : 野瀬                                                     */
   15                               5 I1  ;/*  日  付       : 95.11.01                                                 */
   16                               6 I1  ;/*  概  要       : モニタdefine定義                                         */
   17                               7 I1  ;/*  修正履歴     :                                                          */
   18                               8 I1  ;/*--------------------------------------------------------------------------*/
   19                               9 I1  ;-----------------------------------------------------------------------------
   20                              10 I1  ; ＣＣＲ マスクビット
   21                              11 I1  ;-----------------------------------------------------------------------------
   22          000000F0            12 I1  I_BIT_ON                .EQU    H'000000F0      ; 割込禁止 RISC
   23          0000030F            13 I1  I_BIT_OFF               .EQU    H'0000030F      ; 割込許可 RISC
   24                              14 I1  
   25                              15 I1  ;-----------------------------------------------------------------------------
   26                              16 I1  ; ワンショットタイマ値ＭＡＸ
   27                              17 I1  ;-----------------------------------------------------------------------------
   28          0000001A            18 I1  ONESHOT_VALUE_MAX               .EQU    26
   29                              19 I1  
   30                              20 I1  ;-----------------------------------------------------------------------------
   31                              21 I1  ; タスク イニシャルプログラムNo.
   32                              22 I1  ;-----------------------------------------------------------------------------
   33          00000000            23 I1  INIT_TID                .EQU    0
   34          00000000            24 I1  TSK_INITIAL             .EQU    0
   35                              25 I1  ;TSK_INI_ADDR   .EQU    H'FFFFFC00              ; 初期化用スタック H'FFFFFC00-H'FFFFF000 3
   36          FFFFF830            26 I1  TSK_INI_ADDR    .EQU    H'FFFFF830              ; 内蔵ＲＡＭのモデムバッファの領域を初期化
   37                              27 I1  
   38                              28 I1  ;-----------------------------------------------------------------------------
   39                              29 I1  ; モニタ システム
   40                              30 I1  ;-----------------------------------------------------------------------------
   41                              31 I1  
   42          00000000            32 I1  FLAG_INIT_DATA                  .EQU    H'00000000      ; RISC
   43                              33 I1  
   44                              34 I1  ;TASK_STACK_START               .EQU    H'00809800
   45                              35 I1  
   46                              36 I1  ;LARGE_STACK_MAX                        .EQU    16                      ; RISC
   47                              37 I1  ;SMALL_STACK_MAX                        .EQU    32                      ; RISC
   48                              38 I1  ;TOTAL_STACK_MAX                        .EQU    (SMALL_STACK_MAX+LARGE_STACK_MAX)
   49                              39 I1  ;LARGE_STACK                            .EQU    512
   50                              40 I1  ;SMALL_STACK                            .EQU    256
   51                              41 I1  ;STACK_PUSH_SIZE                        .EQU    88                      ;       スタック退
   52                              42 I1  ;TOP_LARGE_ADDR                         .EQU    (TASK_STACK_START-(SMALL_STACK*SMALL_STACK
   53                              43 I1  ;TOP_SMALL_ADDR                         .EQU    (TASK_STACK_START-STACK_PUSH_SIZE)
   54          00000050            44 I1  STACK_PC_POSITION               .EQU    80
   55                              45 I1  ;STK_RTNVL_PT                   .EQU    76
   56                              46 I1  
   57                              47 I1  ;-----------------------------------------------------------------------------
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE     2
PROGRAM NAME =

   58                              48 I1  ; TIB
   59                              49 I1  ;
   60                              50 I1  ; struct tib_table_data {
   61                              51 I1  ;       unsigned char *start_addr;
   62                              52 I1  ;       unsigned char *end_addr;
   63                              53 I1  ;       unsigned char stack_size;
   64                              54 I1  ;       unsigned char priority;
   65                              55 I1  ;       unsigned short reserve;
   66                              56 I1  ; };
   67                              57 I1  ;
   68                              58 I1  ;    ｮ｢｢｢｢｢｢｢｢｢｢｢ｲ
   69                              59 I1  ;  0 ､                      ､
   70                              60 I1  ;    ､                      ､
   71                              61 I1  ;  1 ､   タスクプログラム   ､
   72                              62 I1  ;    ､   スタートアドレス   ､
   73                              63 I1  ;  2 ､                      ､
   74                              64 I1  ;    ､                      ､
   75                              65 I1  ;  3 ､                      ､
   76                              66 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
   77                              67 I1  ;  4 ､                      ､
   78                              68 I1  ;    ､                      ､
   79                              69 I1  ;  5 ､   異常処理ルーチン   ､
   80                              70 I1  ;    ､   スタートアドレス   ､
   81                              71 I1  ;  6 ､                      ､
   82                              72 I1  ;    ､                      ､
   83                              73 I1  ;  7 ､                      ､
   84                              74 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
   85                              75 I1  ;  8 ､    スタックサイズ    ､  0:Large Stack  1:Small Stack
   86                              76 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
   87                              77 I1  ;  9 ､       優先順位       ､
   88                              78 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
   89                              79 I1  ; 10 ､       リザーブ       ､
   90                              80 I1  ;    ､                      ､
   91                              81 I1  ; 11 ､                      ､
   92                              82 I1  ;    ｶ｢｢｢｢｢｢｢｢｢｢｢ｺ
   93                              83 I1  ;
   94                              84 I1  ;      優先順位(0～255)
   95                              85 I1  ;      ※ 0を最も高い優先順位とします
   96                              86 I1  ;-----------------------------------------------------------------------------
   97                              87 I1  
   98          0000000C            88 I1  TIB_TBL_SIZE    .EQU    12
   99                              89 I1  
  100                              90 I1  ;-- オフセット --
  101          00000000            91 I1  TIB_START_ADR           .EQU    0
  102          00000004            92 I1  TIB_END_ADR                     .EQU    4
  103          00000008            93 I1  TIB_STACK_SIZE          .EQU    8
  104          00000009            94 I1  TIB_PRIORITY            .EQU    9
  105                              95 I1  
  106                              96 I1  ;-----------------------------------------------------------------------------
  107                              97 I1  ; TCB
  108                              98 I1  ;
  109                              99 I1  ; struct tcb_table_data {
  110                             100 I1  ;       unsigned char tsk_stat;
  111                             101 I1  ;       unsigned char prog_no;
  112                             102 I1  ;       unsigned char priority;
  113                             103 I1  ;       unsigned char tsk_link;
  114                             104 I1  ;       unsigned char run_link;
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE     3
PROGRAM NAME =

  115                             105 I1  ;       unsigned char tsk_stat_tpo;
  116                             106 I1  ;       unsigned short reserve;         RISC追加 by T.Nose
  117                             107 I1  ;       unsigned long wait_param;
  118                             108 I1  ;       unsigned char *stack_addr;
  119                             109 I1  ; };
  120                             110 I1  ;
  121                             111 I1  ;    ｮ｢｢ﾎ｢｢｢｢｢｢｢｢ｲ
  122                             112 I1  ;  0 ､STS ､ WAIT時の原因   ､   STS           WAIT時の原因
  123                             113 I1  ;    ｾ｢｢ﾖ｢｢｢｢｢｢｢｢ﾆ   11 : 未使用    1 : 送信待ち
  124                             114 I1  ;  1 ､     プログラムNo.    ､   00 : WAIT      2 : 受信待ち
  125                             115 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ   01 : READY     3 : セマフォ待ち
  126                             116 I1  ;  2 ､       優先順位       ､                  4 : タイマ待ち
  127                             117 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ                  5 : イベントフラグ待ち
  128                             118 I1  ;  3 ､     タスクリンク     ､                  6 : ワンショットタイマ待ち
  129                             119 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
  130                             120 I1  ;  4 ､    強制ランタスク    ､
  131                             121 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
  132                             122 I1  ;  5 ､待ちタスクパラメータ a､
  133                             123 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
  134                             124 I1  ;  6 ､       リザーブ       ､  アドレス調整用 RISC追加 by T.Nose
  135                             125 I1  ;    ､                      ､
  136                             126 I1  ;  7 ､                      ､
  137                             127 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ
  138                             128 I1  ;  8 ､                     b､  1.送信待ち
  139                             129 I1  ;    ､                      ､     a     : MBX No
  140                             130 I1  ;  9 ､                     c､     b～e  : 送信データアドレス
  141                             131 I1  ;    ､                      ､  2.受信待ち
  142                             132 I1  ; 10 ､                     d､     a     : MBX No
  143                             133 I1  ;    ､                      ､     b～e  : 受信データアドレス
  144                             134 I1  ; 11 ､                     e､  3.セマフォ待ち
  145                             135 I1  ;    ｾ｢｢｢｢｢｢｢｢｢｢｢ﾆ     a,d,e : 未使用
  146                             136 I1  ; 12 ､                      ､     b,c   : セマフォ No
  147                             137 I1  ;    ､                      ､  4.タイマ待ち
  148                             138 I1  ; 13 ､                      ､     a,d,e : 未使用
  149                             139 I1  ;    ､   スタックアドレス   ､     b,c   : タイマ値
  150                             140 I1  ; 14 ､                      ､  5.イベントフラグ待ち
  151                             141 I1  ;    ､                      ､     a     : EVENT No
  152                             142 I1  ; 15 ､                      ､     b～e  : 未使用
  153                             143 I1  ;    ｶ｢｢｢｢｢｢｢｢｢｢｢ｺ  6.ワンショットタイマ待ち
  154                             144 I1  ;                                   a～e  : 未使用
  155                             145 I1  
  156                             146 I1  
  157                             147 I1  
  158                             148 I1  
  159                             149 I1  ;      スタックアドレス  初期値 = (実際のアドレス - 32byte)
  160                             150 I1  ;
  161                             151 I1  ;-----------------------------------------------------------------------------
  162                             152 I1  
  163                             153 I1  ;-- オフセット --
  164          00000000           154 I1  TCB_STAT                        .EQU    0
  165          00000001           155 I1  TCB_PROGNO                      .EQU    1
  166          00000002           156 I1  TCB_PRIORITY            .EQU    2
  167          00000003           157 I1  TCB_LINK                        .EQU    3
  168          00000004           158 I1  TCB_RUN_LINK            .EQU    4
  169          00000005           159 I1  TCB_WAIT_PARAM          .EQU    5
  170          00000006           160 I1  TCB_RESERVE                     .EQU    6
  171          00000008           161 I1  TCB_WAIT_PARA1          .EQU    8
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE     4
PROGRAM NAME =

  172          0000000A           162 I1  TCB_WAIT_PARA2          .EQU    10
  173          0000000C           163 I1  TCB_STACK_ADR           .EQU    12
  174                             164 I1  
  175                             165 I1  ;READY_TSK_MAX  .EQU    SMALL_STACK_MAX+LARGE_STACK_MAX
  176          00000010           166 I1  TCB_TBL_SIZE    .EQU    16
  177                             167 I1  
  178          000000FF           168 I1  NIL                             .EQU    H'ff
  179          0000FFFF           169 I1  WORDNIL                 .EQU    H'ffff
  180          FFFFFFFF           170 I1  LONGNIL                 .EQU    H'ffffffff
  181                             171 I1  
  182          00000000           172 I1  WAIT                    .EQU    H'00    ;RISC
  183          00000040           173 I1  READY                   .EQU    H'40    ;RISC
  184          000000C0           174 I1  NOT_USED                .EQU    H'C0    ;RISC
  185                             175 I1  
  186          00000001           176 I1  SND_WAIT                .EQU    H'01
  187          00000002           177 I1  RCV_WAIT                .EQU    H'02
  188          00000003           178 I1  WAIT_SEM                .EQU    H'03
  189          00000004           179 I1  WAIT_TIMER              .EQU    H'04
  190          00000005           180 I1  WAIT_EVENT              .EQU    H'05
  191          00000006           181 I1  WAIT_ONESHOT    .EQU    H'06
  192                             182 I1  
  193          000000FF           183 I1  ERROR                   .EQU    H'ff
  194                             184 I1  
  195                             185 I1  ;-----------------------------------------------------------------------------
  196                             186 I1  ; SCB
  197                             187 I1  ;
  198                             188 I1  ; struct scb_table_data {
  199                             189 I1  ;       unsigned char stat;
  200                             190 I1  ;       unsigned char tid;
  201                             191 I1  ; };
  202                             192 I1  ;
  203                             193 I1  ;    ｮ｢｢ﾎ｢｢｢｢｢｢｢｢ｲ
  204                             194 I1  ;  0 ､STS ､待ちタスクのTID ､
  205                             195 I1  ;    ｾ｢｢ﾖ｢｢｢｢｢｢｢｢ﾆ
  206                             196 I1  ;  1 ､   セマフォ獲得TID    ､
  207                             197 I1  ;    ｶ｢｢｢｢｢｢｢｢｢｢｢ｺ
  208                             198 I1  ;
  209                             199 I1  ;     STS
  210                             200 I1  ;          11 : 未使用
  211                             201 I1  ;          00 : セマフォ値=0
  212                             202 I1  ;          01 : セマフォ値=1
  213                             203 I1  ;
  214                             204 I1  ;     待ちタスクのTID
  215                             205 I1  ;          111111 : 待ちタスクなし
  216                             206 I1  ;
  217                             207 I1  ;-----------------------------------------------------------------------------
  218                             208 I1  
  219                             209 I1  ;SEMNO_MAX              .EQU    32
  220          00000002           210 I1  SCB_TBL_SIZE    .EQU    2
  221          0000007F           211 I1  SCB_INIT                .EQU    H'7F
  222                             212 I1  ;SCB_FREE               .EQU    H'3F
  223                             213 I1  
  224                             214 I1  ;MAX_SEMNO              .EQU    15      ; \src\atlanta\sh7043\define\def_semn.hに
  225                             215 I1                                                          ; 同一の定義有り。同値に保って下さ
  226                             216 I1  
  227                             217 I1  ;-- オフセット --
  228          00000000           218 I1  SCB_STAT                .EQU    0
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE     5
PROGRAM NAME =

  229          00000001           219 I1  SCB_TID                 .EQU    1
  230                             220 I1  
  231                             221 I1  ;-----------------------------------------------------------------------------
  232                             222 I1  ; MCB
  233                             223 I1  ;
  234                             224 I1  ;    ｮ｢｢ﾎ｢｢｢｢｢｢ｲ
  235                             225 I1  ;    ､STS ､    TID     ､
  236                             226 I1  ;    ｶ｢｢ﾖ｢｢｢｢｢｢ｺ
  237                             227 I1  ;
  238                             228 I1  ;     STS                      TID
  239                             229 I1  ;     11 : 未使用              111111
  240                             230 I1  ;     10 : 待ちタスクなし      111111
  241                             231 I1  ;     00 : 送信待ちタスクあり  xxxxxx  待ちタスクの中で最も優先順位の高いTID
  242                             232 I1  ;     01 : 受信待ちタスクあり  xxxxxx  待ちタスクの中で最も優先順位の高いTID
  243                             233 I1  ;
  244                             234 I1  ;-----------------------------------------------------------------------------
  245                             235 I1  
  246                             236 I1  ;MBXNO_MAX              .EQU    256
  247                             237 I1  
  248                             238 I1  ;Task MAX Change T.Nose 1996/10/31
  249          0000007F           239 I1  NO_WAIMBX               .EQU    H'7F    ;<- H'BF
  250                             240 I1  ;SND_MBX                        .EQU    H'00
  251                             241 I1  ;RCV_MBX                        .EQU    H'40
  252                             242 I1  
  253                             243 I1  ;MAX_MBXNO              .EQU    70      ; \src\atlanta\sh7043\define\def_mbxn.h に
  254                             244 I1                                                          ; 同一の定義有り。同値に保って下さ
  255                             245 I1  
  256                             246 I1  ;-----------------------------------------------------------------------------
  257                             247 I1  ; ECB
  258                             248 I1  ;
  259                             249 I1  ;    ｮ｢｢｢｢｢｢｢｢｢ｲ
  260                             250 I1  ;    ､       TID        ､
  261                             251 I1  ;    ｶ｢｢｢｢｢｢｢｢｢ｺ
  262                             252 I1  ;
  263                             253 I1  ;     TID
  264                             254 I1  ;     11111111 : 待ちタスクなし
  265                             255 I1  ;     xxxxxxxx : 待ちタスクのTID
  266                             256 I1  ;
  267                             257 I1  ;-----------------------------------------------------------------------------
  268                             258 I1  
  269                             259 I1  ;;EVENT_MAX             .EQU    74
  270                             260 I1  ;EVENT_MAX              .EQU    94     ; Changed with def_evtn.h for R288F event by H.Kubo
  271                             261 I1  
  272                             262 I1  ;-----------------------------------------------------------------------------
  273                             263 I1  ; Ｃソースモニター用
  274                             264 I1  ;-----------------------------------------------------------------------------
  275          00000001           265 I1  MON_SUCCESS             .EQU    1       ;モニター本体処理の戻値（結果）
  276          00000000           266 I1  MON_FAILURE             .EQU    0
  277                             267 I1  
  278                              11             .INCLUDE        "\src\atlanta\sh7043\define\mon_mac.hdr"
  279                               1 I1  ;/*--------------------------------------------------------------------------*/
  280                               2 I1  ;/*  プロジェクト : POPLAR/ANZU_L                                            */
  281                               3 I1  ;/*  ファイル名   : mon_mac.hdr                                              */
  282                               4 I1  ;/*  作成者       : 野瀬                                                     */
  283                               5 I1  ;/*  日  付       : 1996/10/14                                               */
  284                               6 I1  ;/*  概  要       : モニタマクロ定義                                         */
  285                               7 I1  ;/*  修正履歴     :                                                          */
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE     6
PROGRAM NAME =

  286                               8 I1  ;/*--------------------------------------------------------------------------*/
  287                               9 I1  
  288                              10 I1          .IMPORT         _MON_StackCheckTable
  289                              11 I1          .IMPORT         _SYS_LED1_PortStatus                            ;/* POPLAR_H用 By
  290                              12 I1  
  291                              13 I1  ;-----------------------------------------------------------------------------
  292                              14 I1  ;  アセンブラ　マクロ定義
  293                              15 I1  ;-----------------------------------------------------------------------------
  294                              16 I1  ;
  295                              17 I1  ;/*****************************************************************************
  296                              18 I1  ;       module          :[ｺﾝﾃｷｽﾄを保存する（割込み禁止操作付き）]
  297                              19 I1  ;       function        :[
  298                              20 I1  ;               1.      割込禁止にする
  299                              21 I1  ;               2.      汎用ﾚｼﾞｽﾀ(R0ｰR14)､ｺﾝﾄﾛｰﾙﾚｼﾞｽﾀ(SR､GBR､VBR)､ｼｽﾃﾑﾚｼﾞｽﾀ(MACH､MACL､PR)
  300                              22 I1  ;                       ｽﾀｯｸへｾｰﾌﾞする
  301                              23 I1  ;       ]
  302                              24 I1  ;       return          :[なし]
  303                              25 I1  ;       common          :[]
  304                              26 I1  ;       comment         :[]
  305                              27 I1  ;       machine         :[SH7043]
  306                              28 I1  ;       language        :[ASMSH]
  307                              29 I1  ;       keyword         :[MON]
  308                              30 I1  ;       date            :[1995/10/25]
  309                              31 I1  ;       author          :[野瀬敏弘]
  310                              32 I1  ;*****************************************************************************/
  311                              33 I1  
  312                              34 I1          .MACRO  STCTX_REG
  313                              35 I1  
  314                              36 I1          MOV.L           R0,@-R15                                                ;PUSH.L R0
  315                              37 I1          MOV.L           R1,@-R15                                                ;PUSH.L R1
  316                              38 I1          STC                     SR,R0
  317                              39 I1          MOV.L           STCTX_REG_TBL\@,R1
  318                              40 I1          OR                      R1,R0
  319                              41 I1          LDC                     R0,SR                                                   ;
  320                              42 I1          MOV.L           R2,@-R15                                                ;PUSH.L R2
  321                              43 I1          MOV.L           R3,@-R15                                                ;PUSH.L R3
  322                              44 I1          MOV.L           R4,@-R15                                                ;PUSH.L R4
  323                              45 I1          MOV.L           R5,@-R15                                                ;PUSH.L R5
  324                              46 I1          MOV.L           R6,@-R15                                                ;PUSH.L R6
  325                              47 I1          MOV.L           R7,@-R15                                                ;PUSH.L R7
  326                              48 I1          MOV.L           R8,@-R15                                                ;PUSH.L R8
  327                              49 I1          MOV.L           R9,@-R15                                                ;PUSH.L R9
  328                              50 I1          MOV.L           R10,@-R15                                               ;PUSH.L R1
  329                              51 I1          MOV.L           R11,@-R15                                               ;PUSH.L R1
  330                              52 I1          MOV.L           R12,@-R15                                               ;PUSH.L R1
  331                              53 I1          MOV.L           R13,@-R15                                               ;PUSH.L R1
  332                              54 I1          MOV.L           R14,@-R15                                               ;PUSH.L R1
  333                              55 I1          STC.L           GBR,@-R15                                               ;PUSH.L GB
  334                              56 I1          STC.L           VBR,@-R15                                               ;PUSH.L VB
  335                              57 I1          STS.L           MACH,@-R15                                              ;PUSH.L MA
  336                              58 I1          STS.L           MACL,@-R15                                              ;PUSH.L MA
  337                              59 I1          STS.L           PR,@-R15                                                ;PUSH.L PR
  338                              60 I1  
  339                              61 I1          BRA                     stctx_reg_end\@
  340                              62 I1          NOP
  341                              63 I1  
  342                              64 I1          .ALIGN 4
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE     7
PROGRAM NAME =

  343                              65 I1  STCTX_REG_TBL\@:
  344                              66 I1          .DATA.L         I_BIT_ON
  345                              67 I1  
  346                              68 I1  stctx_reg_end\@:
  347                              69 I1  
  348                              70 I1          .ENDM
  349                              71 I1  
  350                              72 I1  ;/*****************************************************************************
  351                              73 I1  ;       module          :[ｺﾝﾃｷｽﾄを保存する（割込み禁止操作なし）]
  352                              74 I1  ;       function        :[
  353                              75 I1  ;               1.      汎用ﾚｼﾞｽﾀ(R0ｰR14)､ｺﾝﾄﾛｰﾙﾚｼﾞｽﾀ(SR､GBR､VBR)､ｼｽﾃﾑﾚｼﾞｽﾀ(MACH､MACL､PR)
  354                              76 I1  ;                       ｽﾀｯｸへｾｰﾌﾞする
  355                              77 I1  ;       ]
  356                              78 I1  ;       return          :[なし]
  357                              79 I1  ;       common          :[]
  358                              80 I1  ;       comment         :[]
  359                              81 I1  ;       machine         :[SH7043]
  360                              82 I1  ;       language        :[ASMSH]
  361                              83 I1  ;       keyword         :[MON]
  362                              84 I1  ;       date            :[1996/11/12]
  363                              85 I1  ;       author          :[野瀬敏弘]
  364                              86 I1  ;*****************************************************************************/
  365                              87 I1  
  366                              88 I1          .MACRO  STCTX_REG_INT
  367                              89 I1  
  368                              90 I1          MOV.L           R0,@-R15                                                ;PUSH.L R0
  369                              91 I1          MOV.L           R1,@-R15                                                ;PUSH.L R1
  370                              92 I1          MOV.L           R2,@-R15                                                ;PUSH.L R2
  371                              93 I1          MOV.L           R3,@-R15                                                ;PUSH.L R3
  372                              94 I1          MOV.L           R4,@-R15                                                ;PUSH.L R4
  373                              95 I1          MOV.L           R5,@-R15                                                ;PUSH.L R5
  374                              96 I1          MOV.L           R6,@-R15                                                ;PUSH.L R6
  375                              97 I1          MOV.L           R7,@-R15                                                ;PUSH.L R7
  376                              98 I1          MOV.L           R8,@-R15                                                ;PUSH.L R8
  377                              99 I1          MOV.L           R9,@-R15                                                ;PUSH.L R9
  378                             100 I1          MOV.L           R10,@-R15                                               ;PUSH.L R1
  379                             101 I1          MOV.L           R11,@-R15                                               ;PUSH.L R1
  380                             102 I1          MOV.L           R12,@-R15                                               ;PUSH.L R1
  381                             103 I1          MOV.L           R13,@-R15                                               ;PUSH.L R1
  382                             104 I1          MOV.L           R14,@-R15                                               ;PUSH.L R1
  383                             105 I1          STC.L           GBR,@-R15                                               ;PUSH.L GB
  384                             106 I1          STC.L           VBR,@-R15                                               ;PUSH.L VB
  385                             107 I1          STS.L           MACH,@-R15                                              ;PUSH.L MA
  386                             108 I1          STS.L           MACL,@-R15                                              ;PUSH.L MA
  387                             109 I1          STS.L           PR,@-R15                                                ;PUSH.L PR
  388                             110 I1  
  389                             111 I1          .ENDM
  390                             112 I1  
  391                             113 I1  ;/*****************************************************************************
  392                             114 I1  ;       module          :[スタックチェック]
  393                             115 I1  ;       function        :[
  394                             116 I1  ;       ]
  395                             117 I1  ;       return          :[なし]
  396                             118 I1  ;       common          :[]
  397                             119 I1  ;       comment         :[
  398                             120 I1  ;
  399                             121 I1  ;               内部使用レジスタ
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE     8
PROGRAM NAME =

  400                             122 I1  ;                       R0 R12 R13 R14
  401                             123 I1  ;               エラー処理時のみ
  402                             124 I1  ;                       R1 R2
  403                             125 I1  ;
  404                             126 I1  ;                       UDWORD MON_StackCheckTable 4ﾊﾞｲﾄｻｲｽﾞ
  405                             127 I1  ;
  406                             128 I1  ;       ]
  407                             129 I1  ;       machine         :[SH7043]
  408                             130 I1  ;       language        :[ASMSH]
  409                             131 I1  ;       keyword         :[MON]
  410                             132 I1  ;       date            :[1995/10/26]
  411                             133 I1  ;       author          :[野瀬敏弘]
  412                             134 I1  ;*****************************************************************************/
  413                             135 I1  
  414                             136 I1          .MACRO  STACK_CHECK     ERRJUMP
  415                             137 I1  
  416                             138 I1          MOV.L           real_run_tid_STKCHK\@,R12
  417                             139 I1          MOV.B           @R12,R13
  418                             140 I1          EXTU.B          R13,R13                                                 ; R13 = re
  419                             141 I1          SHLL2           R13
  420                             142 I1          MOV.L           MON_StackCheckTable_STKCHK\@,R0
  421                             143 I1          MOV.L           @(R0,R13),R14                                   ; R14 = MON_StackC
  422                             144 I1          CMP/HS          R14,R15
  423                             145 I1          BT                      stack_chk_error\@                               ; SP >= R1
  424                             146 I1          ADD                     #4,R13
  425                             147 I1          MOV.L           @(R0,R13),R14                                   ; R14 = MON_StackC
  426                             148 I1          CMP/HS          R14,R15
  427                             149 I1          BT                      stack_chk_end\@                                 ; SP >= R1
  428                             150 I1  
  429                             151 I1  stack_chk_error\@:
  430                             152 I1          MOV.L           stk_chk_err_STKCHK\@,R1
  431                             153 I1          MOV.L           stk_chk_err_STKCHK\@+4,R2
  432                             154 I1          JMP                     @R2
  433                             155 I1          NOP
  434                             156 I1  
  435                             157 I1          .ALIGN 4
  436                             158 I1  real_run_tid_STKCHK\@:
  437                             159 I1          .DATA.L         _real_run_tid
  438                             160 I1  MON_StackCheckTable_STKCHK\@:
  439                             161 I1          .DATA.L         _MON_StackCheckTable
  440                             162 I1  stk_chk_err_STKCHK\@:
  441                             163 I1          .DATA.L         H'FFFFFFFF
  442                             164 I1          .DATA.L         \ERRJUMP
  443                             165 I1  
  444                             166 I1  stack_chk_end\@
  445                             167 I1  
  446                             168 I1          .ENDM
  447                             169 I1  
  448                             170 I1  
  449                             171 I1  ;/*****************************************************************************
  450                             172 I1  ;       module          :[レジスタの復帰]
  451                             173 I1  ;       function        :[
  452                             174 I1  ;       ]
  453                             175 I1  ;       return          :[なし]
  454                             176 I1  ;       common          :[]
  455                             177 I1  ;       comment         :[
  456                             178 I1  ;       ]
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE     9
PROGRAM NAME =

  457                             179 I1  ;       machine         :[SH7043]
  458                             180 I1  ;       language        :[ASMSH]
  459                             181 I1  ;       keyword         :[MON]
  460                             182 I1  ;       date            :[1995/11/15]
  461                             183 I1  ;       author          :[野瀬敏弘]
  462                             184 I1  ;*****************************************************************************/
  463                             185 I1  
  464                             186 I1          .MACRO  RSTR_REG
  465                             187 I1  
  466                             188 I1          LDS.L   @R15+,PR                        ;POP.L  PR
  467                             189 I1          LDS.L   @R15+,MACL                      ;POP.L  MACL
  468                             190 I1          LDS.L   @R15+,MACH                      ;POP.L  MACH
  469                             191 I1          LDC.L   @R15+,VBR                       ;POP.L  VBR
  470                             192 I1          LDC.L   @R15+,GBR                       ;POP.L  GBR
  471                             193 I1          MOV.L   @R15+,R14                       ;POP.L  R14
  472                             194 I1          MOV.L   @R15+,R13                       ;POP.L  R13
  473                             195 I1          MOV.L   @R15+,R12                       ;POP.L  R12
  474                             196 I1          MOV.L   @R15+,R11                       ;POP.L  R11
  475                             197 I1          MOV.L   @R15+,R10                       ;POP.L  R10
  476                             198 I1          MOV.L   @R15+,R9                        ;POP.L  R9
  477                             199 I1          MOV.L   @R15+,R8                        ;POP.L  R8
  478                             200 I1          MOV.L   @R15+,R7                        ;POP.L  R7
  479                             201 I1          MOV.L   @R15+,R6                        ;POP.L  R6
  480                             202 I1          MOV.L   @R15+,R5                        ;POP.L  R5
  481                             203 I1          MOV.L   @R15+,R4                        ;POP.L  R4
  482                             204 I1          MOV.L   @R15+,R3                        ;POP.L  R3
  483                             205 I1          MOV.L   @R15+,R2                        ;POP.L  R2
  484                             206 I1          MOV.L   @R15+,R1                        ;POP.L  R1
  485                             207 I1          MOV.L   @R15+,R0                        ;POP.L  R0
  486                             208 I1  
  487                             209 I1          .ENDM
  488                             210 I1  
  489                             211 I1  ;/*****************************************************************************
  490                             212 I1  ;       module          :[スタックポインタをＴＣＢにセーブする]
  491                             213 I1  ;       function        :[
  492                             214 I1  ;       ]
  493                             215 I1  ;       return          :[なし]
  494                             216 I1  ;       common          :[]
  495                             217 I1  ;       comment         :[
  496                             218 I1  ;       ]
  497                             219 I1  ;       machine         :[SH7043]
  498                             220 I1  ;       language        :[ASMSH]
  499                             221 I1  ;       keyword         :[MON]
  500                             222 I1  ;       date            :[1996/02/08]
  501                             223 I1  ;       author          :[野瀬敏弘]
  502                             224 I1  ;*****************************************************************************/
  503                             225 I1  
  504                             226 I1          .MACRO  STSP_REG
  505                             227 I1  
  506                             228 I1          MOV.L   real_run_tid_STKCHK\@,R2
  507                             229 I1          MOV.B   @R2,R1
  508                             230 I1          MOV             #TCB_TBL_SIZE,R8
  509                             231 I1          MULU    R1,R8                                                   ; real_run_tid * T
  510                             232 I1          MOV.L   tcb_STKCHK\@,R0
  511                             233 I1          STS             MACL,R2
  512                             234 I1          ADD             R2,R0
  513                             235 I1          MOV.L   R15,@(TCB_STACK_ADR,R0)                                 ; SPセーブ
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    10
PROGRAM NAME =

  514                             236 I1          BRA             save_SP_end\@
  515                             237 I1          NOP
  516                             238 I1  
  517                             239 I1          .ALIGN 4
  518                             240 I1  real_run_tid_STKCHK\@:
  519                             241 I1          .DATA.L         _real_run_tid
  520                             242 I1  tcb_STKCHK\@:
  521                             243 I1          .DATA.L         _tcb
  522                             244 I1  
  523                             245 I1  save_SP_end\@
  524                             246 I1  
  525                             247 I1          .ENDM
  526                             248 I1  
  527                             249 I1  ;/*****************************************************************************
  528                             250 I1  ;       module          :[スタックチェック]
  529                             251 I1  ;       function        :[
  530                             252 I1  ;       ]
  531                             253 I1  ;       return          :[なし]
  532                             254 I1  ;       common          :[
  533                             255 I1  ;               スタックチェックテーブルにはポインタによる間接アドレス参照で
  534                             256 I1  ;               アクセスします
  535                             257 I1  ;       ]
  536                             258 I1  ;       comment         :[
  537                             259 I1  ;
  538                             260 I1  ;               内部使用レジスタ
  539                             261 I1  ;                       R0 R12 R13 R14
  540                             262 I1  ;               エラー処理時のみ
  541                             263 I1  ;                       R1 R2
  542                             264 I1  ;
  543                             265 I1  ;                       UDWORD MON_StackCheckTable_p 4ﾊﾞｲﾄｻｲｽﾞ
  544                             266 I1  ;
  545                             267 I1  ;       ]
  546                             268 I1  ;       machine         :[SH7043]
  547                             269 I1  ;       language        :[ASMSH]
  548                             270 I1  ;       keyword         :[MON]
  549                             271 I1  ;       date            :[1997/04/16]
  550                             272 I1  ;       author          :[野瀬敏弘]
  551                             273 I1  ;*****************************************************************************/
  552                             274 I1  
  553                             275 I1          .MACRO  STACK_CHECK_P   ERRJUMP
  554                             276 I1  
  555                             277 I1          MOV.L           real_run_tid_STKCHK_P\@,R12
  556                             278 I1          MOV.B           @R12,R13
  557                             279 I1          EXTU.B          R13,R13                                                 ; R13 = re
  558                             280 I1          SHLL2           R13
  559                             281 I1  
  560                             282 I1  ;       MOV.L           MON_StackCheckTable_STKCHK\@,R0
  561                             283 I1  ;       下の２行に変更
  562                             284 I1          MOV.L           MON_StackCheckTable_p_STKCHK_P\@,R0
  563                             285 I1          MOV.L           @R0,R0
  564                             286 I1  
  565                             287 I1          MOV.L           @(R0,R13),R14                                   ; R14 = MON_StackC
  566                             288 I1          CMP/HS          R14,R15
  567                             289 I1          BT                      stack_chk_error_p\@                             ; SP >= R1
  568                             290 I1          ADD                     #4,R13
  569                             291 I1          MOV.L           @(R0,R13),R14                                   ; R14 = MON_StackC
  570                             292 I1          CMP/HS          R14,R15
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    11
PROGRAM NAME =

  571                             293 I1          BT                      stack_chk_end_p\@                                       ;
  572                             294 I1  
  573                             295 I1  stack_chk_error_p\@:
  574                             296 I1          MOV.L           stk_chk_err_STKCHK_P\@,R1
  575                             297 I1          JMP                     @R1
  576                             298 I1          NOP
  577                             299 I1  
  578                             300 I1          .ALIGN 4
  579                             301 I1  real_run_tid_STKCHK_P\@:
  580                             302 I1          .DATA.L         _real_run_tid
  581                             303 I1  ;MON_StackCheckTable_STKCHK\@:
  582                             304 I1  ;       .DATA.L         _MON_StackCheckTable
  583                             305 I1  stk_chk_err_STKCHK_P\@:
  584                             306 I1          .DATA.L         \ERRJUMP
  585                             307 I1  MON_StackCheckTable_p_STKCHK_P\@:
  586                             308 I1          .DATA.L         _MON_StackCheckTable_p
  587                             309 I1  
  588                             310 I1  stack_chk_end_p\@
  589                             311 I1  
  590                             312 I1          .ENDM
  591                             313 I1  
  592                             314 I1  ;/*****************************************************************************
  593                             315 I1  ;       module          :[スタックポインタをＴＣＢにセーブする]
  594                             316 I1  ;       function        :[
  595                             317 I1  ;       ]
  596                             318 I1  ;       return          :[なし]
  597                             319 I1  ;       common          :[]
  598                             320 I1  ;       comment         :[
  599                             321 I1  ;               ＴＣＢにはポインタによる間接アドレス参照でアクセスします
  600                             322 I1  ;       ]
  601                             323 I1  ;       machine         :[SH7043]
  602                             324 I1  ;       language        :[ASMSH]
  603                             325 I1  ;       keyword         :[MON]
  604                             326 I1  ;       date            :[1997/04/16]
  605                             327 I1  ;       author          :[野瀬敏弘]
  606                             328 I1  ;*****************************************************************************/
  607                             329 I1  
  608                             330 I1          .MACRO  STSP_REG_P
  609                             331 I1  
  610                             332 I1          MOV.L   real_run_tid_STSP_P\@,R2
  611                             333 I1          MOV.B   @R2,R1
  612                             334 I1          MOV             #TCB_TBL_SIZE,R8
  613                             335 I1          MULU    R1,R8                                                   ; real_run_tid * T
  614                             336 I1          MOV.L   tcbp_STSP_P\@,R0
  615                             337 I1          MOV.L   @R0,R0
  616                             338 I1          STS             MACL,R2
  617                             339 I1          ADD             R2,R0
  618                             340 I1          MOV.L   R15,@(TCB_STACK_ADR,R0)                                 ; SPセーブ
  619                             341 I1          BRA             end_STSP_P\@
  620                             342 I1          NOP
  621                             343 I1  
  622                             344 I1          .ALIGN 4
  623                             345 I1  real_run_tid_STSP_P\@:
  624                             346 I1          .DATA.L         _real_run_tid
  625                             347 I1  tcbp_STSP_P\@:
  626                             348 I1          .DATA.L         _tcb_p
  627                             349 I1  
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    12
PROGRAM NAME =

  628                             350 I1  end_STSP_P\@
  629                             351 I1  
  630                             352 I1          .ENDM
  631                             353 I1  
  632                             354 I1  ;/*****************************************************************************
  633                             355 I1  ;       module          :[割込み禁止 ＆ ポートＯＮ]
  634                             356 I1  ;       function        :[]
  635                             357 I1  ;       return          :[なし]
  636                             358 I1  ;       common          :[]
  637                             359 I1  ;       comment         :[]
  638                             360 I1  ;       machine         :[SH7043]
  639                             361 I1  ;       language        :[ASMSH]
  640                             362 I1  ;       keyword         :[MON]
  641                             363 I1  ;       date            :[1998/01/26]
  642                             364 I1  ;       author          :[野瀬敏弘]
  643                             365 I1  ;*****************************************************************************/
  644                             366 I1  
  645                             367 I1          .MACRO  INTDIS
  646                             368 I1  
  647                             369 I1  ;;;     MOV.L           R0,@-R15                                        ;PUSH.L R0 プッシ
  648                             370 I1          MOV.L           R1,@-R15                                        ;PUSH.L R1
  649                             371 I1          MOV.L           R2,@-R15                                        ;PUSH.L R2
  650                             372 I1  
  651                             373 I1          STC                     SR,R0
  652                             374 I1          MOV.L           INTDIS_TBL\@,R1
  653                             375 I1          OR                      R1,R0
  654                             376 I1          LDC                     R0,SR                                           ;割り込み
  655                             377 I1  
  656                             378 I1  ;割込み禁止開始をポートに出力します
  657                             379 I1  ;ＲＯＭ化の時ははずします
  658                             380 I1  ;       MOV.L           INTDIS_TBL\@+4,R0
  659                             381 I1  ;       MOV.W           INTDIS_TBL\@+D'12,R1
  660                             382 I1  ;       MOV.W           @R0,R2
  661                             383 I1  ;       OR                      R1,R2
  662                             384 I1  ;       MOV.W           R2,@R0                                          ;SYS_COM_PortStatu
  663                             385 I1  ;       MOV.L           INTDIS_TBL\@+8,R1
  664                             386 I1  ;       MOV.W           R2,@R1                                          ;outpw(COM_PORT,SY
  665                             387 I1  ;ここまで
  666                             388 I1  
  667                             389 I1          MOV.L           @R15+,R2                                        ;POP.L  R2
  668                             390 I1          MOV.L           @R15+,R1                                        ;POP.L  R1
  669                             391 I1          MOV.L           @R15+,R0                                        ;POP.L  R0
  670                             392 I1          BRA                     INTDIS_END\@
  671                             393 I1          NOP
  672                             394 I1          .ALIGN 4
  673                             395 I1  INTDIS_TBL\@:
  674                             396 I1  ;       /* 以下はＰＯＰＬＡＲ＿Ｂ／Ｌ用です。 By O.Kimoto 1998/02/12 */
  675                             397 I1  ;       .DATA.L         I_BIT_ON
  676                             398 I1  ;       .DATA.L         _SYS_COM_PortStatus
  677                             399 I1  ;       .DATA.L         H'00C203D0
  678                             400 I1  ;       .DATA.W         H'0020
  679                             401 I1  ;       /* 以下はＰＯＰＬＡＲ＿Ｈ用です。 By O.Kimoto 1998/02/12 */
  680                             402 I1          .DATA.L         I_BIT_ON
  681                             403 I1          .DATA.L         _SYS_LED1_PortStatus    ; 出力ポートのステータス
  682                             404 I1          .DATA.L         H'00C2022A                              ; 出力ポートアドレス
  683                             405 I1          .DATA.W         H'0080                                  ; ＯＮ出力のビットパターン
  684                             406 I1  INTDIS_END\@:
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    13
PROGRAM NAME =

  685                             407 I1  
  686                             408 I1          .ENDM
  687                              12             .INCLUDE        "\src\atlanta\sh7043\ext_v\extv_mon.hdr"
  688                               1 I1  ;/*--------------------------------------------------------------------------*/
  689                               2 I1  ;/*  プロジェクト : POPLAR/ANZU_L                                            */
  690                               3 I1  ;/*  ファイル名   : extv_mon.hdr                                             */
  691                               4 I1  ;/*  作成者       : 野瀬敏弘                                                 */
  692                               5 I1  ;/*  日  付       : 1996/10/14                                               */
  693                               6 I1  ;/*  概  要       : モニタテーブル外部参照                                   */
  694                               7 I1  ;/*  修正履歴     :                                                          */
  695                               8 I1  ;/*--------------------------------------------------------------------------*/
  696                               9 I1  
  697                              10 I1          .IMPORT         _real_run_tid
  698                              11 I1          .IMPORT         _top_ready_tid
  699                              12 I1          .IMPORT         _wai_tsk_tid
  700                              13 I1          .IMPORT         _wai_1shot_tid
  701                              14 I1          .IMPORT         _tib
  702                              15 I1          .IMPORT         _tcb_p
  703                              16 I1          .IMPORT         _scb_p
  704                              17 I1          .IMPORT         _ecb_p
  705                              18 I1          .IMPORT         _mcb_p
  706                              19 I1          .IMPORT         _MON_StackCheckTable_p
  707                              20 I1          .IMPORT         _MON_MAX_LARGE_TCB
  708                              21 I1          .IMPORT         _MON_MAX_SMALL_TCB
  709                              22 I1          .IMPORT         _MON_MAX_TCB
  710                              23 I1          .IMPORT         _MON_SIZE_LARGE_STACK
  711                              24 I1          .IMPORT         _MON_SIZE_SMALL_STACK
  712                              25 I1          .IMPORT         _MON_STACK_START_ADDR
  713                              26 I1          .IMPORT         _MON_TOP_LARGE_ADDR
  714                              27 I1          .IMPORT         _MON_TOP_SMALL_ADDR
  715                              28 I1          .IMPORT         _MON_MAX_SCB
  716                              29 I1          .IMPORT         _MON_MAX_SEMNO
  717                              30 I1          .IMPORT         _MON_MAX_MCB
  718                              31 I1          .IMPORT         _MON_MAX_MBXNO
  719                              32 I1          .IMPORT         _MON_MAX_ECB
  720                              33 I1  
  721                              34 I1  ; 以下の外部参照宣言は後程削除します
  722                              35 I1  ;       .IMPORT         _MON_DebugSwitch
  723                              36 I1  ;       .IMPORT         _tcb
  724                              37 I1  ;       .IMPORT         _scb
  725                              38 I1  ;       .IMPORT         _ecb
  726                              39 I1  ;       .IMPORT         _mcb
  727                              13     
  728                              14             .IMPORT         _cre_ready_link_vec
  729                              15             .IMPORT         _monitor_error_vec
  730                              16     
  731                              17             .EXPORT         _cre_tsk_irom
  732                              18             .EXPORT         _cre_tsk_erom
  733                              19     
  734                              20     ;/*****************************************************************************
  735                              21     ;       module          :[タスクを生成し起動します]
  736                              22     ;       function        :[
  737                              23     ;               1. TCB(タスク・コントロール・ブロック)から空いている領域を探し
  738                              24     ;                  タスクIDにセットします。
  739                              25     ;               2. TCBの初期化を行います。
  740                              26     ;               3. StatusをReadyにします。
  741                              27     ;               4. その時レディタスク・リンクを更新し、優先順位の高い順に
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    14
PROGRAM NAME =

  742                              28     ;                  リンクをつなぎ替えます。
  743                              29     ;       ]
  744                              30     ;       return          :[なし]
  745                              31     ;       common          :[_real_run_tid, _tcb, _tib]
  746                              32     ;       comment         :[
  747                              33     ;               引数レジスタ
  748                              34     ;                       R4 :UWORD *TID
  749                              35     ;                       R5 :UWORD prog_no
  750                              36     ;                       R6 :void *param_addr
  751                              37     ;               内部使用レジスタ
  752                              38     ;       ]
  753                              39     ;       machine         :[SH]
  754                              40     ;       language        :[ASMSH]
  755                              41     ;       keyword         :[MON]
  756                              42     ;       date            :[1995/11/01]
  757                              43     ;       author          :[野瀬敏弘]
  758                              44     ;*****************************************************************************/
  759                              45     ;/**************************/
  760                              46     ;/* ＳＨ７０４３内蔵ＲＯＭ */
  761                              47     ;/**************************/
  762 00000000                     48             .SECTION        MON,CODE,ALIGN=4
  763 00000000                     49     _cre_tsk_irom:
  764 00000000 7FF8                50             ADD             #-8,R15
  765                              51     ;--------------------------------------------------------------
  766                              52             STCTX_REG                                       ;ﾏｸﾛ ﾚｼﾞｽﾀの保存
  767                                 M   
  768 00000002 2F06                   M           MOV.L           R0,@-R15                                                ;PUSH.L R0
  769 00000004 2F16                   M           MOV.L           R1,@-R15                                                ;PUSH.L R1
  770 00000006 0002                   M           STC                     SR,R0
  771 00000008 D10B                   M           MOV.L           STCTX_REG_TBL00000,R1
  772 0000000A 201B                   M           OR                      R1,R0
  773 0000000C 400E                   M           LDC                     R0,SR                                                   ;
  774 0000000E 2F26                   M           MOV.L           R2,@-R15                                                ;PUSH.L R2
  775 00000010 2F36                   M           MOV.L           R3,@-R15                                                ;PUSH.L R3
  776 00000012 2F46                   M           MOV.L           R4,@-R15                                                ;PUSH.L R4
  777 00000014 2F56                   M           MOV.L           R5,@-R15                                                ;PUSH.L R5
  778 00000016 2F66                   M           MOV.L           R6,@-R15                                                ;PUSH.L R6
  779 00000018 2F76                   M           MOV.L           R7,@-R15                                                ;PUSH.L R7
  780 0000001A 2F86                   M           MOV.L           R8,@-R15                                                ;PUSH.L R8
  781 0000001C 2F96                   M           MOV.L           R9,@-R15                                                ;PUSH.L R9
  782 0000001E 2FA6                   M           MOV.L           R10,@-R15                                               ;PUSH.L R1
  783 00000020 2FB6                   M           MOV.L           R11,@-R15                                               ;PUSH.L R1
  784 00000022 2FC6                   M           MOV.L           R12,@-R15                                               ;PUSH.L R1
  785 00000024 2FD6                   M           MOV.L           R13,@-R15                                               ;PUSH.L R1
  786 00000026 2FE6                   M           MOV.L           R14,@-R15                                               ;PUSH.L R1
  787 00000028 4F13                   M           STC.L           GBR,@-R15                                               ;PUSH.L GB
  788 0000002A 4F23                   M           STC.L           VBR,@-R15                                               ;PUSH.L VB
  789 0000002C 4F02                   M           STS.L           MACH,@-R15                                              ;PUSH.L MA
  790 0000002E 4F12                   M           STS.L           MACL,@-R15                                              ;PUSH.L MA
  791 00000030 4F22                   M           STS.L           PR,@-R15                                                ;PUSH.L PR
  792                                 M   
  793 00000032 A003                   M           BRA                     stctx_reg_end00000
  794 00000034 0009                   M           NOP
  795                                 M   
  796 00000038                        M           .ALIGN 4
  797 00000038                        M   STCTX_REG_TBL00000:
  798 00000038 000000F0               M           .DATA.L         I_BIT_ON
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    15
PROGRAM NAME =

  799                                 M   
  800 0000003C                        M   stctx_reg_end00000:
  801                                 M   
  802                              53     ;--------------------------------------------------------------
  803 0000003C 60F3                54             MOV.L   R15,R0
  804 0000003E 7050                55             ADD             #STACK_PC_POSITION,R0
  805 00000040 012A                56             STS             PR,R1
  806 00000042 2012                57             MOV.L   R1,@R0                          ;PR(=PC)をスタックへセーブ
  807                              58     
  808 00000044 7004                59             ADD             #4,R0                           ;INC.L  R0
  809 00000046 0102                60             STC             SR,R1
  810 00000048 D25C                61             MOV.L   I_BIT_OFF_cre_tsk,R2    ;R2 = 0x0000030F
  811 0000004A 2129                62             AND             R2,R1                           ;割込許可
  812 0000004C 2012                63             MOV.L   R1,@R0                          ;SRをスタックへセーブ
  813                              64     
  814                              65     ;--------------------------------------------------------------
  815                              66             STSP_REG_P                                      ;ﾏｸﾛ スタックポインタの保存
  816                                 M   
  817 0000004E D205                   M           MOV.L   real_run_tid_STSP_P00001,R2
  818 00000050 6120                   M           MOV.B   @R2,R1
  819 00000052 E810                   M           MOV             #TCB_TBL_SIZE,R8
  820 00000054 281E                   M           MULU    R1,R8                                                   ; real_run_tid * T
  821 00000056 D004                   M           MOV.L   tcbp_STSP_P00001,R0
  822 00000058 6002                   M           MOV.L   @R0,R0
  823 0000005A 021A                   M           STS             MACL,R2
  824 0000005C 302C                   M           ADD             R2,R0
  825 0000005E 10F3                   M           MOV.L   R15,@(TCB_STACK_ADR,R0)                                 ; SPセーブ
  826 00000060 A004                   M           BRA             end_STSP_P00001
  827 00000062 0009                   M           NOP
  828                                 M   
  829 00000064                        M           .ALIGN 4
  830 00000064                        M   real_run_tid_STSP_P00001:
  831 00000064 00000000               M           .DATA.L         _real_run_tid
  832 00000068                        M   tcbp_STSP_P00001:
  833 00000068 00000000               M           .DATA.L         _tcb_p
  834                                 M   
  835 0000006C                        M   end_STSP_P00001
  836                                 M   
  837                              67     ;--------------------------------------------------------------
  838                              68     ;--------------------------------------------------------------
  839                              69             STACK_CHECK_P   err_cre_tsk             ;ﾏｸﾛ ﾀｽｸﾁｪｯｸ
  840                                 M   
  841 0000006C DC07                   M           MOV.L           real_run_tid_STKCHK_P00002,R12
  842 0000006E 6DC0                   M           MOV.B           @R12,R13
  843 00000070 6DDC                   M           EXTU.B          R13,R13                                                 ; R13 = re
  844 00000072 4D08                   M           SHLL2           R13
  845                                 M   
  846                                 M   ;       MOV.L           MON_StackCheckTable_STKCHK00002,R0
  847                                 M   ;       下の２行に変更
  848 00000074 D007                   M           MOV.L           MON_StackCheckTable_p_STKCHK_P00002,R0
  849 00000076 6002                   M           MOV.L           @R0,R0
  850                                 M   
  851 00000078 0EDE                   M           MOV.L           @(R0,R13),R14                                   ; R14 = MON_StackC
  852 0000007A 3FE2                   M           CMP/HS          R14,R15
  853 0000007C 8903                   M           BT                      stack_chk_error_p00002                          ; SP >= R1
  854 0000007E 7D04                   M           ADD                     #4,R13
  855 00000080 0EDE                   M           MOV.L           @(R0,R13),R14                                   ; R14 = MON_StackC
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    16
PROGRAM NAME =

  856 00000082 3FE2                   M           CMP/HS          R14,R15
  857 00000084 8908                   M           BT                      stack_chk_end_p00002                                    ;
  858                                 M   
  859 00000086                        M   stack_chk_error_p00002:
  860 00000086 D102                   M           MOV.L           stk_chk_err_STKCHK_P00002,R1
  861 00000088 412B                   M           JMP                     @R1
  862 0000008A 0009                   M           NOP
  863                                 M   
  864 0000008C                        M           .ALIGN 4
  865 0000008C                        M   real_run_tid_STKCHK_P00002:
  866 0000008C 00000000               M           .DATA.L         _real_run_tid
  867                                 M   ;MON_StackCheckTable_STKCHK00002:
  868                                 M   ;       .DATA.L         _MON_StackCheckTable
  869 00000090                        M   stk_chk_err_STKCHK_P00002:
  870 00000090 00000000               M           .DATA.L         err_cre_tsk
  871 00000094                        M   MON_StackCheckTable_p_STKCHK_P00002:
  872 00000094 00000000               M           .DATA.L         _MON_StackCheckTable_p
  873                                 M   
  874 00000098                        M   stack_chk_end_p00002
  875                                 M   
  876                              70     ;--------------------------------------------------------------
  877                              71     
  878 00000098 E80C                72             MOV             #TIB_TBL_SIZE,R8
  879 0000009A 285E                73             MULU    R5,R8
  880 0000009C 031A                74             STS             MACL,R3
  881 0000009E D948                75             MOV.L   tib_cre_tsk,R9
  882 000000A0 6992                76             MOV.L   @R9,R9
  883 000000A2 393C                77             ADD             R3,R9
  884 000000A4 8498                78             MOV.B   @(TIB_STACK_SIZE,R9),R0
  885 000000A6 8800                79             CMP/EQ  #0,R0
  886 000000A8 8917                80             BT              cre_stack_large
  887                              81     
  888                              82     ;空きtcbの検索
  889                              83     ;出力 R1:掴んだtcbのオフセット値
  890 000000AA                     84     cre_stack_small:
  891 000000AA 3118                85             SUB             R1,R1
  892 000000AC D24D                86             MOV.L   MON_MAX_SMALL_TCB_cretsk_i,R2
  893 000000AE 6220                87             MOV.B   @R2,R2
  894 000000B0 D94B                88             MOV.L   tcbp_cretsk_i,R9
  895 000000B2 6992                89             MOV.L   @R9,R9
  896 000000B4 E810                90             MOV             #TCB_TBL_SIZE,R8
  897 000000B6                     91     search_tcb_small:
  898 000000B6 8490                92             MOV.B   @(TCB_STAT,R9),R0
  899 000000B8 88C0                93             CMP/EQ  #NOT_USED,R0
  900 000000BA 8905                94             BT              set_stack_small
  901 000000BC 7101                95             ADD             #1,R1
  902 000000BE 3122                96             CMP/HS  R2,R1
  903 000000C0 8977                97             BT              err_cre_tsk                     ; R1 >= SMALL_STACK_MAX -> err_cre
  904 000000C2 398C                98             ADD             R8,R9
  905 000000C4 AFF7                99             BRA             search_tcb_small
  906 000000C6 0009               100             NOP
  907                             101     
  908                             102     ;生成する小タスクのスタックアドレスを求める
  909                             103     ;入力 R1 :掴んだtcbのオフセット値
  910                             104     ;出力 R2 :生成する小タスクのスタックの底アドレス-84
  911 000000C8                    105     set_stack_small:
  912 000000C8 D341               106             MOV.L   MON_SIZE_SMALL_STACK_cretsk_i,R3
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    17
PROGRAM NAME =

  913 000000CA 6331               107             MOV.W   @R3,R3
  914 000000CC 633D               108             EXTU.W  R3,R3
  915 000000CE 231E               109             MULU    R1,R3
  916 000000D0 D241               110             MOV.L   MON_TOP_SMALL_ADDR_cretsk_i,R2
  917 000000D2 6222               111             MOV.L   @R2,R2
  918 000000D4 081A               112             STS             MACL,R8
  919 000000D6 A020               113             BRA             set_tcb
  920 000000D8 3288               114             SUB             R8,R2
  921                             115     
  922                             116     ;空きtcbの検索
  923                             117     ;出力 R1:掴んだtcbのオフセット値
  924 000000DA                    118     cre_stack_large:
  925 000000DA D142               119             MOV.L   MON_MAX_SMALL_TCB_cretsk_i,R1
  926 000000DC 6110               120             MOV.B   @R1,R1
  927 000000DE E810               121             MOV             #TCB_TBL_SIZE,R8
  928 000000E0 281E               122             MULU    R1,R8
  929 000000E2 031A               123             STS             MACL,R3
  930 000000E4 D93E               124             MOV.L   tcbp_cretsk_i,R9
  931 000000E6 6992               125             MOV.L   @R9,R9
  932 000000E8 393C               126             ADD             R3,R9
  933 000000EA D23F               127             MOV.L   MON_MAX_LARGE_TCB_cretsk_i,R2
  934 000000EC 6220               128             MOV.B   @R2,R2
  935 000000EE 321C               129             ADD             R1,R2
  936 000000F0                    130     search_tcb_large:
  937 000000F0 8490               131             MOV.B   @(TCB_STAT,R9),R0
  938 000000F2 88C0               132             CMP/EQ  #NOT_USED,R0
  939 000000F4 8905               133             BT              set_stack_large
  940 000000F6 7101               134             ADD             #1,R1
  941 000000F8 3122               135             CMP/HS  R2,R1
  942 000000FA 895A               136             BT              err_cre_tsk                     ; R1 >= LARGE_STACK_MAX -> err_cre
  943 000000FC 398C               137             ADD             R8,R9
  944 000000FE AFF7               138             BRA             search_tcb_large
  945 00000100 0009               139             NOP
  946                             140     
  947                             141     ;生成する大タスクのスタックアドレスを求める
  948                             142     ;入力 R1 :掴んだtcbのオフセット値
  949                             143     ;出力 R2:生成する大タスクのスタックの底アドレス-84
  950 00000102                    144     set_stack_large:
  951 00000102 D334               145             MOV.L   MON_SIZE_LARGE_STACK_cretsk_i,R3
  952 00000104 6331               146             MOV.W   @R3,R3
  953 00000106 633D               147             EXTU.W  R3,R3
  954 00000108 6813               148             MOV             R1,R8
  955 0000010A D736               149             MOV.L   MON_MAX_SMALL_TCB_cretsk_i,R7
  956 0000010C 6770               150             MOV.B   @R7,R7
  957 0000010E 3878               151             SUB             R7,R8
  958 00000110 283E               152             MULU    R3,R8
  959 00000112 081A               153             STS             MACL,R8
  960 00000114 D231               154             MOV.L   MON_TOP_LARGE_ADDR_cretsk_i,R2
  961 00000116 6222               155             MOV.L   @R2,R2
  962 00000118 3288               156             SUB             R8,R2
  963                             157     
  964                             158     ;引数 *TID を初期化する
  965 0000011A                    159     set_tcb:
  966 0000011A 2411               160             MOV.W   R1,@R4                          ; *TID = R1
  967                             161     
  968                             162     ;生成するタスクのtcb、スタックの初期化データを求める
  969                             163     ;出力 R8:生成するタスクの優先順位
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    18
PROGRAM NAME =

  970                             164     ;     R9:生成するタスクのスタートアドレス
  971 0000011C E30C               165             MOV             #TIB_TBL_SIZE,R3
  972 0000011E 253E               166             MULU    R3,R5
  973 00000120 081A               167             STS             MACL,R8
  974 00000122 D927               168             MOV.L   tib_cre_tsk,R9
  975 00000124 6992               169             MOV.L   @R9,R9
  976 00000126 398C               170             ADD             R8,R9
  977 00000128 8499               171             MOV.B   @(TIB_PRIORITY,R9),R0
  978 0000012A 680C               172             EXTU.B  R0,R8                                   ; R8 = tib[prog_no].priority
  979 0000012C 5990               173             MOV.L   @(TIB_START_ADR,R9),R9  ; R9 = tib[prog_no].start_addr
  980                             174     
  981                             175     ;生成するタスクのtcbを初期化する
  982 0000012E E310               176             MOV             #TCB_TBL_SIZE,R3
  983 00000130 231E               177             MULU    R1,R3
  984 00000132 D32B               178             MOV.L   tcbp_cretsk_i,R3
  985 00000134 6332               179             MOV.L   @R3,R3
  986 00000136 0A1A               180             STS             MACL,R10
  987 00000138 E040               181             MOV.B   #READY,R0
  988 0000013A 33AC               182             ADD             R10,R3                          ; R3 = 生成するタスクのtcbの先頭ア
  989 0000013C 8030               183             MOV.B   R0,@(TCB_STAT,R3)       ; tcb[R1].tsk_stat = READY
  990 0000013E 6053               184             MOV             R5,R0
  991 00000140 8031               185             MOV.B   R0,@(TCB_PROGNO,R3)     ; tcb[R1].prog_no = prog_no
  992 00000142 6083               186             MOV             R8,R0
  993 00000144 8032               187             MOV.B   R0,@(TCB_PRIORITY,R3)   ; tcb[R1].priority = tib[prog_no].priority
  994 00000146 3008               188             SUB             R0,R0
  995 00000148 8035               189             MOV.B   R0,@(TCB_WAIT_PARAM,R3) ; tcb[R1].tsk_stat_tpo = 0
  996 0000014A 1323               190             MOV.L   R2,@(TCB_STACK_ADR,R3)  ; tcb[R1].*stack_addr = R2
  997                             191     
  998                             192     ;生成するタスクのスタックを初期化する
  999 0000014C 3338               193             SUB             R3,R3
 1000 0000014E 2232               194             MOV.L   R3,@R2          ; R2(PR)
 1001 00000150 7204               195             ADD             #4,R2
 1002 00000152 2232               196             MOV.L   R3,@R2          ; R2+4(MACL)
 1003 00000154 7204               197             ADD             #4,R2
 1004 00000156 2232               198             MOV.L   R3,@R2          ; R2+8(MACH)
 1005                             199     
 1006                             200             ; その時のVBRの値をそのまま書き込む
 1007 00000158 7204               201             ADD             #4,R2
 1008 0000015A 0322               202             STC             VBR,R3
 1009 0000015C 2232               203             MOV.L   R3,@R2          ; R2+12(VBR)
 1010 0000015E 3338               204             SUB             R3,R3
 1011                             205     
 1012 00000160 7204               206             ADD             #4,R2
 1013 00000162 2232               207             MOV.L   R3,@R2          ; R2+16(GBR)
 1014 00000164 7204               208             ADD             #4,R2
 1015 00000166 2232               209             MOV.L   R3,@R2          ; R2+20(R14)
 1016 00000168 7204               210             ADD             #4,R2
 1017 0000016A 2232               211             MOV.L   R3,@R2          ; R2+24(R13)
 1018 0000016C 7204               212             ADD             #4,R2
 1019 0000016E 2232               213             MOV.L   R3,@R2          ; R2+28(R12)
 1020 00000170 7204               214             ADD             #4,R2
 1021 00000172 2232               215             MOV.L   R3,@R2          ; R2+32(R11)
 1022 00000174 7204               216             ADD             #4,R2
 1023 00000176 2232               217             MOV.L   R3,@R2          ; R2+36(R10)
 1024 00000178 7204               218             ADD             #4,R2
 1025 0000017A 2232               219             MOV.L   R3,@R2          ; R2+40(R9)
 1026 0000017C 7204               220             ADD             #4,R2
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    19
PROGRAM NAME =

 1027 0000017E 2232               221             MOV.L   R3,@R2          ; R2+44(R8)
 1028 00000180 7204               222             ADD             #4,R2
 1029 00000182 2232               223             MOV.L   R3,@R2          ; R2+48(R7)
 1030 00000184 7204               224             ADD             #4,R2
 1031 00000186 2232               225             MOV.L   R3,@R2          ; R2+52(R6)
 1032 00000188 7204               226             ADD             #4,R2
 1033 0000018A 2232               227             MOV.L   R3,@R2          ; R2+56(R5)
 1034 0000018C 7204               228             ADD             #4,R2
 1035 0000018E 2262               229             MOV.L   R6,@R2          ; R2+60(R4) 引数 *param_adr をレジスタで渡す
 1036 00000190 7204               230             ADD             #4,R2
 1037 00000192 2232               231             MOV.L   R3,@R2          ; R2+64(R3)
 1038 00000194 7204               232             ADD             #4,R2
 1039 00000196 2232               233             MOV.L   R3,@R2          ; R2+68(R2)
 1040 00000198 7204               234             ADD             #4,R2
 1041 0000019A 2232               235             MOV.L   R3,@R2          ; R2+72(R1)
 1042 0000019C 7204               236             ADD             #4,R2
 1043 0000019E 2232               237             MOV.L   R3,@R2          ; R2+76(R0)
 1044 000001A0 7204               238             ADD             #4,R2
 1045 000001A2 2292               239             MOV.L   R9,@R2          ; R2+80(PC)
 1046 000001A4 7204               240             ADD             #4,R2
 1047 000001A6 DA07               241             MOV.L   FLAG_INIT_DATA_cre_tsk,R10
 1048 000001A8 22A2               242             MOV.L   R10,@R2         ; R2+84(SR)
 1049                             243     
 1050 000001AA D207               244             MOV.L   cre_ready_link_cre_tsk,R2
 1051 000001AC 6322               245             MOV.L   @R2,R3
 1052 000001AE 432B               246             JMP             @R3
 1053 000001B0 0009               247             NOP
 1054                             248     
 1055 000001B2                    249     err_cre_tsk:
 1056 000001B2 D106               250             MOV.L   monitor_error_cre_tsk,R1
 1057 000001B4 6112               251             MOV.L   @R1,R1
 1058 000001B6 412B               252             JMP             @R1
 1059 000001B8 0009               253             NOP
 1060                             254     
 1061 000001BC                    255             .ALIGN 4
 1062 000001BC                    256     I_BIT_OFF_cre_tsk:
 1063 000001BC 0000030F           257             .DATA.L I_BIT_OFF
 1064 000001C0                    258     tib_cre_tsk:
 1065 000001C0 00000000           259             .DATA.L _tib_p
m:\src\atlanta\sh7043\mon\cre_tsk.src(259) : 200 (E) UNDEFINED SYMBOL REFERENCE
 1066 000001C4                    260     FLAG_INIT_DATA_cre_tsk:
 1067 000001C4 00000000           261             .DATA.L FLAG_INIT_DATA
 1068 000001C8                    262     cre_ready_link_cre_tsk:
 1069 000001C8 00000000           263             .DATA.L _cre_ready_link_vec
 1070 000001CC                    264     monitor_error_cre_tsk:
 1071 000001CC 00000000           265             .DATA.L _monitor_error_vec
 1072 000001D0                    266     MON_SIZE_SMALL_STACK_cretsk_i:
 1073 000001D0 00000000           267             .DATA.L _MON_SIZE_SMALL_STACK
 1074 000001D4                    268     MON_SIZE_LARGE_STACK_cretsk_i:
 1075 000001D4 00000000           269             .DATA.L _MON_SIZE_LARGE_STACK
 1076 000001D8                    270     MON_TOP_SMALL_ADDR_cretsk_i:
 1077 000001D8 00000000           271             .DATA.L _MON_TOP_SMALL_ADDR
 1078 000001DC                    272     MON_TOP_LARGE_ADDR_cretsk_i:
 1079 000001DC 00000000           273             .DATA.L _MON_TOP_LARGE_ADDR
 1080 000001E0                    274     tcbp_cretsk_i:
 1081 000001E0 00000000           275             .DATA.L _tcb_p
 1082 000001E4                    276     MON_MAX_SMALL_TCB_cretsk_i:
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    20
PROGRAM NAME =

 1083 000001E4 00000000           277             .DATA.L _MON_MAX_SMALL_TCB
 1084 000001E8                    278     MON_MAX_LARGE_TCB_cretsk_i:
 1085 000001E8 00000000           279             .DATA.L _MON_MAX_LARGE_TCB
 1086                             280     
 1087                             281     
 1088                             282     ;/****************/
 1089                             283     ;/* 外付けＲＯＭ */
 1090                             284     ;/****************/
 1091 00000000                    285             .SECTION        P,CODE,ALIGN=4
 1092 00000000                    286     _cre_tsk_erom:
 1093 00000000 7FF8               287             ADD             #-8,R15
 1094                             288     ;--------------------------------------------------------------
 1095                             289             STCTX_REG                                       ;ﾏｸﾛ ﾚｼﾞｽﾀの保存
 1096                                 M   
 1097 00000002 2F06                   M           MOV.L           R0,@-R15                                                ;PUSH.L R0
 1098 00000004 2F16                   M           MOV.L           R1,@-R15                                                ;PUSH.L R1
 1099 00000006 0002                   M           STC                     SR,R0
 1100 00000008 D10B                   M           MOV.L           STCTX_REG_TBL00003,R1
 1101 0000000A 201B                   M           OR                      R1,R0
 1102 0000000C 400E                   M           LDC                     R0,SR                                                   ;
 1103 0000000E 2F26                   M           MOV.L           R2,@-R15                                                ;PUSH.L R2
 1104 00000010 2F36                   M           MOV.L           R3,@-R15                                                ;PUSH.L R3
 1105 00000012 2F46                   M           MOV.L           R4,@-R15                                                ;PUSH.L R4
 1106 00000014 2F56                   M           MOV.L           R5,@-R15                                                ;PUSH.L R5
 1107 00000016 2F66                   M           MOV.L           R6,@-R15                                                ;PUSH.L R6
 1108 00000018 2F76                   M           MOV.L           R7,@-R15                                                ;PUSH.L R7
 1109 0000001A 2F86                   M           MOV.L           R8,@-R15                                                ;PUSH.L R8
 1110 0000001C 2F96                   M           MOV.L           R9,@-R15                                                ;PUSH.L R9
 1111 0000001E 2FA6                   M           MOV.L           R10,@-R15                                               ;PUSH.L R1
 1112 00000020 2FB6                   M           MOV.L           R11,@-R15                                               ;PUSH.L R1
 1113 00000022 2FC6                   M           MOV.L           R12,@-R15                                               ;PUSH.L R1
 1114 00000024 2FD6                   M           MOV.L           R13,@-R15                                               ;PUSH.L R1
 1115 00000026 2FE6                   M           MOV.L           R14,@-R15                                               ;PUSH.L R1
 1116 00000028 4F13                   M           STC.L           GBR,@-R15                                               ;PUSH.L GB
 1117 0000002A 4F23                   M           STC.L           VBR,@-R15                                               ;PUSH.L VB
 1118 0000002C 4F02                   M           STS.L           MACH,@-R15                                              ;PUSH.L MA
 1119 0000002E 4F12                   M           STS.L           MACL,@-R15                                              ;PUSH.L MA
 1120 00000030 4F22                   M           STS.L           PR,@-R15                                                ;PUSH.L PR
 1121                                 M   
 1122 00000032 A003                   M           BRA                     stctx_reg_end00003
 1123 00000034 0009                   M           NOP
 1124                                 M   
 1125 00000038                        M           .ALIGN 4
 1126 00000038                        M   STCTX_REG_TBL00003:
 1127 00000038 000000F0               M           .DATA.L         I_BIT_ON
 1128                                 M   
 1129 0000003C                        M   stctx_reg_end00003:
 1130                                 M   
 1131                             290     ;--------------------------------------------------------------
 1132 0000003C 60F3               291             MOV.L   R15,R0
 1133 0000003E 7050               292             ADD             #STACK_PC_POSITION,R0
 1134 00000040 012A               293             STS             PR,R1
 1135 00000042 2012               294             MOV.L   R1,@R0                          ;PR(=PC)をスタックへセーブ
 1136                             295     
 1137 00000044 7004               296             ADD             #4,R0                           ;INC.L  R0
 1138 00000046 0102               297             STC             SR,R1
 1139 00000048 D25C               298             MOV.L   I_BIT_OFF_cre_tsk_e,R2  ;R2 = 0x0000030F
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    21
PROGRAM NAME =

 1140 0000004A 2129               299             AND             R2,R1                           ;割込許可
 1141 0000004C 2012               300             MOV.L   R1,@R0                          ;SRをスタックへセーブ
 1142                             301     
 1143                             302     ;--------------------------------------------------------------
 1144                             303             STSP_REG_P                                      ;ﾏｸﾛ スタックポインタの保存
 1145                                 M   
 1146 0000004E D205                   M           MOV.L   real_run_tid_STSP_P00004,R2
 1147 00000050 6120                   M           MOV.B   @R2,R1
 1148 00000052 E810                   M           MOV             #TCB_TBL_SIZE,R8
 1149 00000054 281E                   M           MULU    R1,R8                                                   ; real_run_tid * T
 1150 00000056 D004                   M           MOV.L   tcbp_STSP_P00004,R0
 1151 00000058 6002                   M           MOV.L   @R0,R0
 1152 0000005A 021A                   M           STS             MACL,R2
 1153 0000005C 302C                   M           ADD             R2,R0
 1154 0000005E 10F3                   M           MOV.L   R15,@(TCB_STACK_ADR,R0)                                 ; SPセーブ
 1155 00000060 A004                   M           BRA             end_STSP_P00004
 1156 00000062 0009                   M           NOP
 1157                                 M   
 1158 00000064                        M           .ALIGN 4
 1159 00000064                        M   real_run_tid_STSP_P00004:
 1160 00000064 00000000               M           .DATA.L         _real_run_tid
 1161 00000068                        M   tcbp_STSP_P00004:
 1162 00000068 00000000               M           .DATA.L         _tcb_p
 1163                                 M   
 1164 0000006C                        M   end_STSP_P00004
 1165                                 M   
 1166                             304     ;--------------------------------------------------------------
 1167                             305     ;--------------------------------------------------------------
 1168                             306             STACK_CHECK_P   err_cre_tsk_e   ;ﾏｸﾛ ﾀｽｸﾁｪｯｸ
 1169                                 M   
 1170 0000006C DC07                   M           MOV.L           real_run_tid_STKCHK_P00005,R12
 1171 0000006E 6DC0                   M           MOV.B           @R12,R13
 1172 00000070 6DDC                   M           EXTU.B          R13,R13                                                 ; R13 = re
 1173 00000072 4D08                   M           SHLL2           R13
 1174                                 M   
 1175                                 M   ;       MOV.L           MON_StackCheckTable_STKCHK00005,R0
 1176                                 M   ;       下の２行に変更
 1177 00000074 D007                   M           MOV.L           MON_StackCheckTable_p_STKCHK_P00005,R0
 1178 00000076 6002                   M           MOV.L           @R0,R0
 1179                                 M   
 1180 00000078 0EDE                   M           MOV.L           @(R0,R13),R14                                   ; R14 = MON_StackC
 1181 0000007A 3FE2                   M           CMP/HS          R14,R15
 1182 0000007C 8903                   M           BT                      stack_chk_error_p00005                          ; SP >= R1
 1183 0000007E 7D04                   M           ADD                     #4,R13
 1184 00000080 0EDE                   M           MOV.L           @(R0,R13),R14                                   ; R14 = MON_StackC
 1185 00000082 3FE2                   M           CMP/HS          R14,R15
 1186 00000084 8908                   M           BT                      stack_chk_end_p00005                                    ;
 1187                                 M   
 1188 00000086                        M   stack_chk_error_p00005:
 1189 00000086 D102                   M           MOV.L           stk_chk_err_STKCHK_P00005,R1
 1190 00000088 412B                   M           JMP                     @R1
 1191 0000008A 0009                   M           NOP
 1192                                 M   
 1193 0000008C                        M           .ALIGN 4
 1194 0000008C                        M   real_run_tid_STKCHK_P00005:
 1195 0000008C 00000000               M           .DATA.L         _real_run_tid
 1196                                 M   ;MON_StackCheckTable_STKCHK00005:
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    22
PROGRAM NAME =

 1197                                 M   ;       .DATA.L         _MON_StackCheckTable
 1198 00000090                        M   stk_chk_err_STKCHK_P00005:
 1199 00000090 00000000               M           .DATA.L         err_cre_tsk_e
 1200 00000094                        M   MON_StackCheckTable_p_STKCHK_P00005:
 1201 00000094 00000000               M           .DATA.L         _MON_StackCheckTable_p
 1202                                 M   
 1203 00000098                        M   stack_chk_end_p00005
 1204                                 M   
 1205                             307     ;--------------------------------------------------------------
 1206                             308     
 1207 00000098 E80C               309             MOV             #TIB_TBL_SIZE,R8
 1208 0000009A 285E               310             MULU    R5,R8
 1209 0000009C 031A               311             STS             MACL,R3
 1210 0000009E D948               312             MOV.L   tib_cre_tsk_e,R9
 1211 000000A0 6992               313             MOV.L   @R9,R9
 1212 000000A2 393C               314             ADD             R3,R9
 1213 000000A4 8498               315             MOV.B   @(TIB_STACK_SIZE,R9),R0
 1214 000000A6 8800               316             CMP/EQ  #0,R0
 1215 000000A8 8917               317             BT              cre_stack_large_e
 1216                             318     
 1217                             319     ;空きtcbの検索
 1218                             320     ;出力 R1:掴んだtcbのオフセット値
 1219 000000AA                    321     cre_stack_small_e:
 1220 000000AA 3118               322             SUB             R1,R1
 1221                             323     ;       MOV             #SMALL_STACK_MAX,R2
 1222                             324     ;FOR POINTER ACCESS
 1223 000000AC D24D               325             MOV.L   MON_MAX_SMALL_TCB_cretsk_e,R2
 1224 000000AE 6220               326             MOV.B   @R2,R2
 1225                             327     
 1226                             328     ;       MOV.L   tcb_cre_tsk_e,R9
 1227                             329     ;FOR POINTER ACCESS
 1228 000000B0 D94B               330             MOV.L   tcbp_cretsk_e,R9
 1229 000000B2 6992               331             MOV.L   @R9,R9
 1230                             332     
 1231 000000B4 E810               333             MOV             #TCB_TBL_SIZE,R8
 1232 000000B6                    334     search_tcb_small_e:
 1233 000000B6 8490               335             MOV.B   @(TCB_STAT,R9),R0
 1234 000000B8 88C0               336             CMP/EQ  #NOT_USED,R0
 1235 000000BA 8905               337             BT              set_stack_small_e
 1236 000000BC 7101               338             ADD             #1,R1
 1237 000000BE 3122               339             CMP/HS  R2,R1
 1238 000000C0 8977               340             BT              err_cre_tsk_e                   ; R1 >= SMALL_STACK_MAX -> err_cre
 1239 000000C2 398C               341             ADD             R8,R9
 1240 000000C4 AFF7               342             BRA             search_tcb_small_e
 1241 000000C6 0009               343             NOP
 1242                             344     
 1243                             345     ;生成する小タスクのスタックアドレスを求める
 1244                             346     ;入力 R1 :掴んだtcbのオフセット値
 1245                             347     ;出力 R2 :生成する小タスクのスタックの底アドレス-84
 1246 000000C8                    348     set_stack_small_e:
 1247                             349     ;       MOV.W   SMALL_STACK_cre_tsk_e,R3
 1248                             350     ;FOR POINTER ACCESS
 1249 000000C8 D341               351             MOV.L   MON_SIZE_SMALL_STACK_cretsk_e,R3
 1250 000000CA 6331               352             MOV.W   @R3,R3
 1251                             353     
 1252 000000CC 633D               354             EXTU.W  R3,R3
 1253 000000CE 231E               355             MULU    R1,R3
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    23
PROGRAM NAME =

 1254                             356     
 1255                             357     ;       MOV.L   TOP_SMALL_ADDR_cre_tsk_e,R2
 1256                             358     ;FOR POINTER ACCESS
 1257 000000D0 D241               359             MOV.L   MON_TOP_SMALL_ADDR_cretsk_e,R2
 1258 000000D2 6222               360             MOV.L   @R2,R2
 1259                             361     
 1260 000000D4 081A               362             STS             MACL,R8
 1261 000000D6 A020               363             BRA             set_tcb_e
 1262 000000D8 3288               364             SUB             R8,R2
 1263                             365     
 1264                             366     ;空きtcbの検索
 1265                             367     ;出力 R1:掴んだtcbのオフセット値
 1266 000000DA                    368     cre_stack_large_e:
 1267                             369     ;       MOV             #SMALL_STACK_MAX,R1
 1268                             370     ;FOR POINTER ACCESS
 1269 000000DA D142               371             MOV.L   MON_MAX_SMALL_TCB_cretsk_e,R1
 1270 000000DC 6110               372             MOV.B   @R1,R1
 1271                             373     
 1272 000000DE E810               374             MOV             #TCB_TBL_SIZE,R8
 1273 000000E0 281E               375             MULU    R1,R8
 1274 000000E2 031A               376             STS             MACL,R3
 1275                             377     
 1276                             378     ;       MOV.L   tcb_cre_tsk_e,R9
 1277                             379     ;FOR POINTER ACCESS
 1278 000000E4 D93E               380             MOV.L   tcbp_cretsk_e,R9
 1279 000000E6 6992               381             MOV.L   @R9,R9
 1280                             382     
 1281 000000E8 393C               383             ADD             R3,R9
 1282                             384     ;       MOV             #SMALL_STACK_MAX,R2
 1283                             385     ;       ADD             #LARGE_STACK_MAX,R2
 1284                             386     ;FOR POINTER ACCESS
 1285 000000EA D23F               387             MOV.L   MON_MAX_LARGE_TCB_cretsk_e,R2
 1286 000000EC 6220               388             MOV.B   @R2,R2
 1287 000000EE 321C               389             ADD             R1,R2
 1288 000000F0                    390     search_tcb_large_e:
 1289 000000F0 8490               391             MOV.B   @(TCB_STAT,R9),R0
 1290 000000F2 88C0               392             CMP/EQ  #NOT_USED,R0
 1291 000000F4 8905               393             BT              set_stack_large_e
 1292 000000F6 7101               394             ADD             #1,R1
 1293 000000F8 3122               395             CMP/HS  R2,R1
 1294 000000FA 895A               396             BT              err_cre_tsk_e                   ; R1 >= LARGE_STACK_MAX -> err_cre
 1295 000000FC 398C               397             ADD             R8,R9
 1296 000000FE AFF7               398             BRA             search_tcb_large_e
 1297 00000100 0009               399             NOP
 1298                             400     
 1299                             401     ;生成する大タスクのスタックアドレスを求める
 1300                             402     ;入力 R1 :掴んだtcbのオフセット値
 1301                             403     ;出力 R2:生成する大タスクのスタックの底アドレス-84
 1302 00000102                    404     set_stack_large_e:
 1303                             405     ;       MOV.W   LARGE_STACK_cre_tsk_e,R3
 1304                             406     ;FOR POINTER ACCESS
 1305 00000102 D334               407             MOV.L   MON_SIZE_LARGE_STACK_cretsk_e,R3
 1306 00000104 6331               408             MOV.W   @R3,R3
 1307                             409     
 1308 00000106 633D               410             EXTU.W  R3,R3
 1309                             411     
 1310 00000108 6813               412             MOV             R1,R8
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    24
PROGRAM NAME =

 1311                             413     ;       ADD             #-SMALL_STACK_MAX,R8
 1312                             414     ;FOR POINTER ACCESS
 1313 0000010A D736               415             MOV.L   MON_MAX_SMALL_TCB_cretsk_e,R7
 1314 0000010C 6770               416             MOV.B   @R7,R7
 1315 0000010E 3878               417             SUB             R7,R8
 1316                             418     
 1317 00000110 283E               419             MULU    R3,R8
 1318 00000112 081A               420             STS             MACL,R8
 1319                             421     
 1320                             422     ;       MOV.L   TOP_LARGE_ADDR_cre_tsk_e,R2
 1321                             423     ;FOR POINTER ACCESS
 1322 00000114 D231               424             MOV.L   MON_TOP_LARGE_ADDR_cretsk_e,R2
 1323 00000116 6222               425             MOV.L   @R2,R2
 1324                             426     
 1325 00000118 3288               427             SUB             R8,R2
 1326                             428     
 1327                             429     ;引数 *TID を初期化する
 1328 0000011A                    430     set_tcb_e:
 1329 0000011A 2411               431             MOV.W   R1,@R4                          ; *TID = R1
 1330                             432     
 1331                             433     ;生成するタスクのtcb、スタックの初期化データを求める
 1332                             434     ;出力 R8:生成するタスクの優先順位
 1333                             435     ;     R9:生成するタスクのスタートアドレス
 1334 0000011C E30C               436             MOV             #TIB_TBL_SIZE,R3
 1335 0000011E 253E               437             MULU    R3,R5
 1336 00000120 081A               438             STS             MACL,R8
 1337 00000122 D927               439             MOV.L   tib_cre_tsk_e,R9
 1338 00000124 6992               440             MOV.L   @R9,R9
 1339 00000126 398C               441             ADD             R8,R9
 1340 00000128 8499               442             MOV.B   @(TIB_PRIORITY,R9),R0
 1341 0000012A 680C               443             EXTU.B  R0,R8                                   ; R8 = tib[prog_no].priority
 1342 0000012C 5990               444             MOV.L   @(TIB_START_ADR,R9),R9  ; R9 = tib[prog_no].start_addr
 1343                             445     
 1344                             446     ;生成するタスクのtcbを初期化する
 1345 0000012E E310               447             MOV             #TCB_TBL_SIZE,R3
 1346 00000130 231E               448             MULU    R1,R3
 1347                             449     
 1348                             450     ;       MOV.L   tcb_cre_tsk_e,R3
 1349                             451     ;FOR POINTER ACCESS
 1350 00000132 D32B               452             MOV.L   tcbp_cretsk_e,R3
 1351 00000134 6332               453             MOV.L   @R3,R3
 1352                             454     
 1353 00000136 0A1A               455             STS             MACL,R10
 1354 00000138 E040               456             MOV.B   #READY,R0
 1355 0000013A 33AC               457             ADD             R10,R3                          ; R3 = 生成するタスクのtcbの先頭ア
 1356 0000013C 8030               458             MOV.B   R0,@(TCB_STAT,R3)       ; tcb[R1].tsk_stat = READY
 1357 0000013E 6053               459             MOV             R5,R0
 1358 00000140 8031               460             MOV.B   R0,@(TCB_PROGNO,R3)     ; tcb[R1].prog_no = prog_no
 1359 00000142 6083               461             MOV             R8,R0
 1360 00000144 8032               462             MOV.B   R0,@(TCB_PRIORITY,R3)   ; tcb[R1].priority = tib[prog_no].priority
 1361 00000146 3008               463             SUB             R0,R0
 1362 00000148 8035               464             MOV.B   R0,@(TCB_WAIT_PARAM,R3) ; tcb[R1].tsk_stat_tpo = 0
 1363 0000014A 1323               465             MOV.L   R2,@(TCB_STACK_ADR,R3)  ; tcb[R1].*stack_addr = R2
 1364                             466     
 1365                             467     ;生成するタスクのスタックを初期化する
 1366 0000014C 3338               468             SUB             R3,R3
 1367 0000014E 2232               469             MOV.L   R3,@R2          ; R2(PR)
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    25
PROGRAM NAME =

 1368 00000150 7204               470             ADD             #4,R2
 1369 00000152 2232               471             MOV.L   R3,@R2          ; R2+4(MACL)
 1370 00000154 7204               472             ADD             #4,R2
 1371 00000156 2232               473             MOV.L   R3,@R2          ; R2+8(MACH)
 1372                             474     
 1373                             475             ; その時のVBRの値をそのまま書き込む
 1374 00000158 7204               476             ADD             #4,R2
 1375 0000015A 0322               477             STC             VBR,R3
 1376 0000015C 2232               478             MOV.L   R3,@R2          ; R2+12(VBR)
 1377 0000015E 3338               479             SUB             R3,R3
 1378                             480     
 1379 00000160 7204               481             ADD             #4,R2
 1380 00000162 2232               482             MOV.L   R3,@R2          ; R2+16(GBR)
 1381 00000164 7204               483             ADD             #4,R2
 1382 00000166 2232               484             MOV.L   R3,@R2          ; R2+20(R14)
 1383 00000168 7204               485             ADD             #4,R2
 1384 0000016A 2232               486             MOV.L   R3,@R2          ; R2+24(R13)
 1385 0000016C 7204               487             ADD             #4,R2
 1386 0000016E 2232               488             MOV.L   R3,@R2          ; R2+28(R12)
 1387 00000170 7204               489             ADD             #4,R2
 1388 00000172 2232               490             MOV.L   R3,@R2          ; R2+32(R11)
 1389 00000174 7204               491             ADD             #4,R2
 1390 00000176 2232               492             MOV.L   R3,@R2          ; R2+36(R10)
 1391 00000178 7204               493             ADD             #4,R2
 1392 0000017A 2232               494             MOV.L   R3,@R2          ; R2+40(R9)
 1393 0000017C 7204               495             ADD             #4,R2
 1394 0000017E 2232               496             MOV.L   R3,@R2          ; R2+44(R8)
 1395 00000180 7204               497             ADD             #4,R2
 1396 00000182 2232               498             MOV.L   R3,@R2          ; R2+48(R7)
 1397 00000184 7204               499             ADD             #4,R2
 1398 00000186 2232               500             MOV.L   R3,@R2          ; R2+52(R6)
 1399 00000188 7204               501             ADD             #4,R2
 1400 0000018A 2232               502             MOV.L   R3,@R2          ; R2+56(R5)
 1401 0000018C 7204               503             ADD             #4,R2
 1402 0000018E 2262               504             MOV.L   R6,@R2          ; R2+60(R4) 引数 *param_adr をレジスタで渡す
 1403 00000190 7204               505             ADD             #4,R2
 1404 00000192 2232               506             MOV.L   R3,@R2          ; R2+64(R3)
 1405 00000194 7204               507             ADD             #4,R2
 1406 00000196 2232               508             MOV.L   R3,@R2          ; R2+68(R2)
 1407 00000198 7204               509             ADD             #4,R2
 1408 0000019A 2232               510             MOV.L   R3,@R2          ; R2+72(R1)
 1409 0000019C 7204               511             ADD             #4,R2
 1410 0000019E 2232               512             MOV.L   R3,@R2          ; R2+76(R0)
 1411 000001A0 7204               513             ADD             #4,R2
 1412 000001A2 2292               514             MOV.L   R9,@R2          ; R2+80(PC)
 1413 000001A4 7204               515             ADD             #4,R2
 1414 000001A6 DA07               516             MOV.L   FLAG_INIT_DATA_cre_tsk_e,R10
 1415 000001A8 22A2               517             MOV.L   R10,@R2         ; R2+84(SR)
 1416                             518     
 1417 000001AA D207               519             MOV.L   cre_ready_link_cre_tsk_e,R2
 1418 000001AC 6322               520             MOV.L   @R2,R3
 1419 000001AE 432B               521             JMP             @R3
 1420 000001B0 0009               522             NOP
 1421                             523     
 1422 000001B2                    524     err_cre_tsk_e:
 1423 000001B2 D106               525             MOV.L   monitor_error_cre_tsk_e,R1
 1424 000001B4 6112               526             MOV.L   @R1,R1
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    26
PROGRAM NAME =

 1425 000001B6 412B               527             JMP             @R1
 1426 000001B8 0009               528             NOP
 1427                             529     
 1428 000001BC                    530             .ALIGN 4
 1429 000001BC                    531     I_BIT_OFF_cre_tsk_e:
 1430 000001BC 0000030F           532             .DATA.L I_BIT_OFF
 1431 000001C0                    533     tib_cre_tsk_e:
 1432 000001C0 00000000           534             .DATA.L _tib_p
m:\src\atlanta\sh7043\mon\cre_tsk.src(534) : 200 (E) UNDEFINED SYMBOL REFERENCE
 1433                             535     ;SMALL_STACK_cre_tsk_e:
 1434                             536     ;       .DATA.W SMALL_STACK
 1435                             537     ;LARGE_STACK_cre_tsk_e:
 1436                             538     ;       .DATA.W LARGE_STACK
 1437                             539     ;TOP_SMALL_ADDR_cre_tsk_e:
 1438                             540     ;       .DATA.L TOP_SMALL_ADDR
 1439                             541     ;TOP_LARGE_ADDR_cre_tsk_e:
 1440                             542     ;       .DATA.L TOP_LARGE_ADDR
 1441                             543     ;tcb_cre_tsk_e:
 1442                             544     ;       .DATA.L _tcb
 1443 000001C4                    545     FLAG_INIT_DATA_cre_tsk_e:
 1444 000001C4 00000000           546             .DATA.L FLAG_INIT_DATA
 1445 000001C8                    547     cre_ready_link_cre_tsk_e:
 1446 000001C8 00000000           548             .DATA.L _cre_ready_link_vec
 1447 000001CC                    549     monitor_error_cre_tsk_e:
 1448 000001CC 00000000           550             .DATA.L _monitor_error_vec
 1449 000001D0                    551     MON_SIZE_SMALL_STACK_cretsk_e:
 1450 000001D0 00000000           552             .DATA.L _MON_SIZE_SMALL_STACK
 1451 000001D4                    553     MON_SIZE_LARGE_STACK_cretsk_e:
 1452 000001D4 00000000           554             .DATA.L _MON_SIZE_LARGE_STACK
 1453 000001D8                    555     MON_TOP_SMALL_ADDR_cretsk_e:
 1454 000001D8 00000000           556             .DATA.L _MON_TOP_SMALL_ADDR
 1455 000001DC                    557     MON_TOP_LARGE_ADDR_cretsk_e:
 1456 000001DC 00000000           558             .DATA.L _MON_TOP_LARGE_ADDR
 1457 000001E0                    559     tcbp_cretsk_e:
 1458 000001E0 00000000           560             .DATA.L _tcb_p
 1459 000001E4                    561     MON_MAX_SMALL_TCB_cretsk_e:
 1460 000001E4 00000000           562             .DATA.L _MON_MAX_SMALL_TCB
 1461 000001E8                    563     MON_MAX_LARGE_TCB_cretsk_e:
 1462 000001E8 00000000           564             .DATA.L _MON_MAX_LARGE_TCB
 1463                             565     
 1464                             566             .END
  *****TOTAL ERRORS       2
  *****TOTAL WARNINGS     0
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    27

*** CROSS REFERENCE LIST

NAME                             SECTION  ATTR VALUE             SEQUENCE

ERROR                                     EQU  000000FF    193*
FLAG_INIT_DATA                            EQU  00000000     42* 1067  1444 
FLAG_INIT_DATA_cre_tsk           MON           000001C4   1047  1066*
FLAG_INIT_DATA_cre_tsk_e         P             000001C4   1414  1443*
INIT_TID                                  EQU  00000000     33*
I_BIT_OFF                                 EQU  0000030F     23* 1063  1430 
I_BIT_OFF_cre_tsk                MON           000001BC    810  1062*
I_BIT_OFF_cre_tsk_e              P             000001BC   1139  1429*
I_BIT_ON                                  EQU  000000F0     22*  798  1127 
LONGNIL                                   EQU  FFFFFFFF    180*
MON                              MON      SCT  00000000    762*
MON_FAILURE                               EQU  00000000    276*
MON_MAX_LARGE_TCB_cretsk_e       P             000001E8   1285  1461*
MON_MAX_LARGE_TCB_cretsk_i       MON           000001E8    933  1084*
MON_MAX_SMALL_TCB_cretsk_e       P             000001E4   1223  1269  1313  1459*
MON_MAX_SMALL_TCB_cretsk_i       MON           000001E4    892   925   955  1082*
MON_SIZE_LARGE_STACK_cretsk_e    P             000001D4   1305  1451*
MON_SIZE_LARGE_STACK_cretsk_i    MON           000001D4    951  1074*
MON_SIZE_SMALL_STACK_cretsk_e    P             000001D0   1249  1449*
MON_SIZE_SMALL_STACK_cretsk_i    MON           000001D0    912  1072*
MON_SUCCESS                               EQU  00000001    275*
MON_StackCheckTable_p_STKCHK_P00*MON           00000094    848   871*
MON_StackCheckTable_p_STKCHK_P00*P             00000094   1177  1200*
MON_TOP_LARGE_ADDR_cretsk_e      P             000001DC   1322  1455*
MON_TOP_LARGE_ADDR_cretsk_i      MON           000001DC    960  1078*
MON_TOP_SMALL_ADDR_cretsk_e      P             000001D8   1257  1453*
MON_TOP_SMALL_ADDR_cretsk_i      MON           000001D8    916  1076*
NIL                                       EQU  000000FF    178*
NOT_USED                                  EQU  000000C0    184*  899   938  1234  1290 
NO_WAIMBX                                 EQU  0000007F    249*
ONESHOT_VALUE_MAX                         EQU  0000001A     28*
P                                P        SCT  00000000   1091*
RCV_WAIT                                  EQU  00000002    187*
READY                                     EQU  00000040    183*  987  1354 
SCB_INIT                                  EQU  0000007F    221*
SCB_STAT                                  EQU  00000000    228*
SCB_TBL_SIZE                              EQU  00000002    220*
SCB_TID                                   EQU  00000001    229*
SND_WAIT                                  EQU  00000001    186*
STACK_PC_POSITION                         EQU  00000050     54*  804  1133 
STCTX_REG_TBL00000               MON           00000038    771   797*
STCTX_REG_TBL00003               P             00000038   1100  1126*
TCB_LINK                                  EQU  00000003    167*
TCB_PRIORITY                              EQU  00000002    166*  993  1360 
TCB_PROGNO                                EQU  00000001    165*  991  1358 
TCB_RESERVE                               EQU  00000006    170*
TCB_RUN_LINK                              EQU  00000004    168*
TCB_STACK_ADR                             EQU  0000000C    173*  825   996  1154  1363 
TCB_STAT                                  EQU  00000000    164*  898   937   989  1233  1289  1356 
TCB_TBL_SIZE                              EQU  00000010    176*  819   896   927   982  1148  1231  1272  1345 
TCB_WAIT_PARA1                            EQU  00000008    171*
TCB_WAIT_PARA2                            EQU  0000000A    172*
TCB_WAIT_PARAM                            EQU  00000005    169*  995  1362 
TIB_END_ADR                               EQU  00000004    102*
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    28

*** CROSS REFERENCE LIST

NAME                             SECTION  ATTR VALUE             SEQUENCE

TIB_PRIORITY                              EQU  00000009    104*  977  1340 
TIB_STACK_SIZE                            EQU  00000008    103*  884  1213 
TIB_START_ADR                             EQU  00000000    101*  979  1342 
TIB_TBL_SIZE                              EQU  0000000C     98*  878   971  1207  1334 
TSK_INITIAL                               EQU  00000000     34*
TSK_INI_ADDR                              EQU  FFFFF830     36*
WAIT                                      EQU  00000000    182*
WAIT_EVENT                                EQU  00000005    190*
WAIT_ONESHOT                              EQU  00000006    191*
WAIT_SEM                                  EQU  00000003    188*
WAIT_TIMER                                EQU  00000004    189*
WORDNIL                                   EQU  0000FFFF    179*
_MON_MAX_ECB                              IMPT 00000000    719 
_MON_MAX_LARGE_TCB                        IMPT 00000000    707  1085  1462 
_MON_MAX_MBXNO                            IMPT 00000000    718 
_MON_MAX_MCB                              IMPT 00000000    717 
_MON_MAX_SCB                              IMPT 00000000    715 
_MON_MAX_SEMNO                            IMPT 00000000    716 
_MON_MAX_SMALL_TCB                        IMPT 00000000    708  1083  1460 
_MON_MAX_TCB                              IMPT 00000000    709 
_MON_SIZE_LARGE_STACK                     IMPT 00000000    710  1075  1452 
_MON_SIZE_SMALL_STACK                     IMPT 00000000    711  1073  1450 
_MON_STACK_START_ADDR                     IMPT 00000000    712 
_MON_StackCheckTable                      IMPT 00000000    288 
_MON_StackCheckTable_p                    IMPT 00000000    706   872  1201 
_MON_TOP_LARGE_ADDR                       IMPT 00000000    713  1079  1456 
_MON_TOP_SMALL_ADDR                       IMPT 00000000    714  1077  1454 
_SYS_LED1_PortStatus                      IMPT 00000000    289 
_cre_ready_link_vec                       IMPT 00000000    728  1069  1446 
_cre_tsk_erom                    P        EXPT 00000000    732  1092*
_cre_tsk_irom                    MON      EXPT 00000000    731   763*
_ecb_p                                    IMPT 00000000    704 
_mcb_p                                    IMPT 00000000    705 
_monitor_error_vec                        IMPT 00000000    729  1071  1448 
_real_run_tid                             IMPT 00000000    697   831   866  1160  1195 
_scb_p                                    IMPT 00000000    703 
_tcb_p                                    IMPT 00000000    702   833  1081  1162  1458 
_tib                                      IMPT 00000000    701 
_tib_p                                    UDEF 00000000   1065  1432 
_top_ready_tid                            IMPT 00000000    698 
_wai_1shot_tid                            IMPT 00000000    700 
_wai_tsk_tid                              IMPT 00000000    699 
cre_ready_link_cre_tsk           MON           000001C8   1050  1068*
cre_ready_link_cre_tsk_e         P             000001C8   1417  1445*
cre_stack_large                  MON           000000DA    886   924*
cre_stack_large_e                P             000000DA   1215  1266*
cre_stack_small                  MON           000000AA    890*
cre_stack_small_e                P             000000AA   1219*
end_STSP_P00001                  MON           0000006C    826   835*
end_STSP_P00004                  P             0000006C   1155  1164*
err_cre_tsk                      MON           000001B2    870   903   942  1055*
err_cre_tsk_e                    P             000001B2   1199  1238  1294  1422*
monitor_error_cre_tsk            MON           000001CC   1056  1070*
monitor_error_cre_tsk_e          P             000001CC   1423  1447*
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    29

*** CROSS REFERENCE LIST

NAME                             SECTION  ATTR VALUE             SEQUENCE

real_run_tid_STKCHK_P00002       MON           0000008C    841   865*
real_run_tid_STKCHK_P00005       P             0000008C   1170  1194*
real_run_tid_STSP_P00001         MON           00000064    817   830*
real_run_tid_STSP_P00004         P             00000064   1146  1159*
search_tcb_large                 MON           000000F0    936*  944 
search_tcb_large_e               P             000000F0   1288* 1296 
search_tcb_small                 MON           000000B6    897*  905 
search_tcb_small_e               P             000000B6   1232* 1240 
set_stack_large                  MON           00000102    939   950*
set_stack_large_e                P             00000102   1291  1302*
set_stack_small                  MON           000000C8    900   911*
set_stack_small_e                P             000000C8   1235  1246*
set_tcb                          MON           0000011A    919   965*
set_tcb_e                        P             0000011A   1261  1328*
stack_chk_end_p00002             MON           00000098    857   874*
stack_chk_end_p00005             P             00000098   1186  1203*
stack_chk_error_p00002           MON           00000086    853   859*
stack_chk_error_p00005           P             00000086   1182  1188*
stctx_reg_end00000               MON           0000003C    793   800*
stctx_reg_end00003               P             0000003C   1122  1129*
stk_chk_err_STKCHK_P00002        MON           00000090    860   869*
stk_chk_err_STKCHK_P00005        P             00000090   1189  1198*
tcbp_STSP_P00001                 MON           00000068    821   832*
tcbp_STSP_P00004                 P             00000068   1150  1161*
tcbp_cretsk_e                    P             000001E0   1228  1278  1350  1457*
tcbp_cretsk_i                    MON           000001E0    894   930   984  1080*
tib_cre_tsk                      MON           000001C0    881   974  1064*
tib_cre_tsk_e                    P             000001C0   1210  1337  1431*
*** SH SERIES ASSEMBLER Ver. 2.0 ***      08/26/98 13:00:07                                                              PAGE    30

*** SECTION DATA LIST

SECTION                          ATTRIBUTE    SIZE             START

MON                              REL-CODE    0000001EC        
P                                REL-CODE    0000001EC        
